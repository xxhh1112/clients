{"version":3,"file":"connectors/webauthn-fallback.8a52bc25eecd48aeeb6f.js","mappings":"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","sources":["webpack://@bitwarden/web-vault/webpack/bootstrap","webpack://@bitwarden/web-vault/webpack/runtime/make namespace object","webpack://@bitwarden/web-vault/./src/connectors/common.ts","webpack://@bitwarden/web-vault/./src/connectors/common-webauthn.ts","webpack://@bitwarden/web-vault/./src/translation-constants.ts","webpack://@bitwarden/web-vault/./src/connectors/translation.service.ts","webpack://@bitwarden/web-vault/../../libs/common/src/services/translation.service.ts","webpack://@bitwarden/web-vault/./src/connectors/webauthn-fallback.ts"],"sourcesContent":["// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export function getQsParam(name: string) {\n  const url = window.location.href;\n  // eslint-disable-next-line\n  name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n  const regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\");\n  const results = regex.exec(url);\n\n  if (!results) {\n    return null;\n  }\n  if (!results[2]) {\n    return \"\";\n  }\n\n  return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n}\n\nexport function b64Decode(str: string, spaceAsPlus = false) {\n  if (spaceAsPlus) {\n    str = str.replace(/ /g, \"+\");\n  }\n\n  return decodeURIComponent(\n    Array.prototype.map\n      .call(atob(str), (c: string) => {\n        return \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2);\n      })\n      .join(\"\")\n  );\n}\n","export function buildDataString(assertedCredential: PublicKeyCredential) {\n  const response = assertedCredential.response as AuthenticatorAssertionResponse;\n\n  const authData = new Uint8Array(response.authenticatorData);\n  const clientDataJSON = new Uint8Array(response.clientDataJSON);\n  const rawId = new Uint8Array(assertedCredential.rawId);\n  const sig = new Uint8Array(response.signature);\n\n  const data = {\n    id: assertedCredential.id,\n    rawId: coerceToBase64Url(rawId),\n    type: assertedCredential.type,\n    extensions: assertedCredential.getClientExtensionResults(),\n    response: {\n      authenticatorData: coerceToBase64Url(authData),\n      clientDataJson: coerceToBase64Url(clientDataJSON),\n      signature: coerceToBase64Url(sig),\n    },\n  };\n\n  return JSON.stringify(data);\n}\n\nexport function parseWebauthnJson(jsonString: string) {\n  const json = JSON.parse(jsonString);\n\n  const challenge = json.challenge.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  json.challenge = Uint8Array.from(atob(challenge), (c) => c.charCodeAt(0));\n\n  json.allowCredentials.forEach((listItem: any) => {\n    // eslint-disable-next-line\n    const fixedId = listItem.id.replace(/\\_/g, \"/\").replace(/\\-/g, \"+\");\n    listItem.id = Uint8Array.from(atob(fixedId), (c) => c.charCodeAt(0));\n  });\n\n  return json;\n}\n\n// From https://github.com/abergs/fido2-net-lib/blob/b487a1d47373ea18cd752b4988f7262035b7b54e/Demo/wwwroot/js/helpers.js#L34\n// License: https://github.com/abergs/fido2-net-lib/blob/master/LICENSE.txt\nfunction coerceToBase64Url(thing: any) {\n  // Array or ArrayBuffer to Uint8Array\n  if (Array.isArray(thing)) {\n    thing = Uint8Array.from(thing);\n  }\n\n  if (thing instanceof ArrayBuffer) {\n    thing = new Uint8Array(thing);\n  }\n\n  // Uint8Array to base64\n  if (thing instanceof Uint8Array) {\n    let str = \"\";\n    const len = thing.byteLength;\n\n    for (let i = 0; i < len; i++) {\n      str += String.fromCharCode(thing[i]);\n    }\n    thing = window.btoa(str);\n  }\n\n  if (typeof thing !== \"string\") {\n    throw new Error(\"could not coerce to string\");\n  }\n\n  // base64 to base64url\n  // NOTE: \"=\" at the end of challenge is optional, strip it off here\n  thing = thing.replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=*$/g, \"\");\n\n  return thing;\n}\n","// Please leave 'en' where it is, as it's our fallback language in case no translation can be found\nexport const SupportedTranslationLocales: string[] = [\n  \"en\",\n  \"af\",\n  \"ar\",\n  \"az\",\n  \"be\",\n  \"bg\",\n  \"bn\",\n  \"bs\",\n  \"ca\",\n  \"cs\",\n  \"da\",\n  \"de\",\n  \"el\",\n  \"en-GB\",\n  \"en-IN\",\n  \"eo\",\n  \"es\",\n  \"et\",\n  \"eu\",\n  \"fi\",\n  \"fil\",\n  \"fr\",\n  \"he\",\n  \"hi\",\n  \"hr\",\n  \"hu\",\n  \"id\",\n  \"it\",\n  \"ja\",\n  \"ka\",\n  \"km\",\n  \"kn\",\n  \"ko\",\n  \"lv\",\n  \"ml\",\n  \"nb\",\n  \"nl\",\n  \"nn\",\n  \"pl\",\n  \"pt-PT\",\n  \"pt-BR\",\n  \"ro\",\n  \"ru\",\n  \"si\",\n  \"sk\",\n  \"sl\",\n  \"sr\",\n  \"sv\",\n  \"tr\",\n  \"uk\",\n  \"vi\",\n  \"zh-CN\",\n  \"zh-TW\",\n];\n","import { TranslationService as BaseTranslationService } from \"@bitwarden/common/services/translation.service\";\n\nimport { SupportedTranslationLocales } from \"../translation-constants\";\n\nexport class TranslationService extends BaseTranslationService {\n  private _translationLocale: string;\n\n  constructor(systemLanguage: string, localesDirectory: string) {\n    super(systemLanguage || \"en-US\", localesDirectory, async (formattedLocale: string) => {\n      const filePath =\n        this.localesDirectory +\n        \"/\" +\n        formattedLocale +\n        \"/messages.json?cache=\" +\n        process.env.CACHE_TAG;\n      const localesResult = await fetch(filePath);\n      const locales = await localesResult.json();\n      return locales;\n    });\n\n    this.supportedTranslationLocales = SupportedTranslationLocales;\n  }\n\n  get translationLocale(): string {\n    return this._translationLocale;\n  }\n\n  set translationLocale(locale: string) {\n    this._translationLocale = locale;\n  }\n}\n","import { TranslationService as TranslationServiceAbstraction } from \"../abstractions/translation.service\";\n\nexport abstract class TranslationService implements TranslationServiceAbstraction {\n  // First locale is the default (English)\n  supportedTranslationLocales: string[] = [\"en\"];\n  defaultLocale = \"en\";\n  abstract translationLocale: string;\n  collator: Intl.Collator;\n  localeNames = new Map<string, string>([\n    [\"af\", \"Afrikaans\"],\n    [\"ar\", \"العربية الفصحى\"],\n    [\"az\", \"Azərbaycanca\"],\n    [\"be\", \"Беларуская\"],\n    [\"bg\", \"български\"],\n    [\"bn\", \"বাংলা\"],\n    [\"bs\", \"bosanski jezik\"],\n    [\"ca\", \"català\"],\n    [\"cs\", \"čeština\"],\n    [\"da\", \"dansk\"],\n    [\"de\", \"Deutsch\"],\n    [\"el\", \"Ελληνικά\"],\n    [\"en\", \"English\"],\n    [\"en-GB\", \"English (British)\"],\n    [\"en-IN\", \"English (India)\"],\n    [\"eo\", \"Esperanto\"],\n    [\"es\", \"español\"],\n    [\"et\", \"eesti\"],\n    [\"eu\", \"euskara\"],\n    [\"fa\", \"فارسی\"],\n    [\"fi\", \"suomi\"],\n    [\"fil\", \"Wikang Filipino\"],\n    [\"fr\", \"français\"],\n    [\"he\", \"עברית\"],\n    [\"hi\", \"हिन्दी\"],\n    [\"hr\", \"hrvatski\"],\n    [\"hu\", \"magyar\"],\n    [\"id\", \"Bahasa Indonesia\"],\n    [\"it\", \"italiano\"],\n    [\"ja\", \"日本語\"],\n    [\"ka\", \"ქართული\"],\n    [\"km\", \"ខ្មែរ, ខេមរភាសា, ភាសាខ្មែរ\"],\n    [\"kn\", \"ಕನ್ನಡ\"],\n    [\"ko\", \"한국어\"],\n    [\"lt\", \"lietuvių kalba\"],\n    [\"lv\", \"Latvietis\"],\n    [\"me\", \"црногорски\"],\n    [\"ml\", \"മലയാളം\"],\n    [\"nb\", \"norsk (bokmål)\"],\n    [\"nl\", \"Nederlands\"],\n    [\"nn\", \"Norsk Nynorsk\"],\n    [\"pl\", \"polski\"],\n    [\"pt-BR\", \"português do Brasil\"],\n    [\"pt-PT\", \"português\"],\n    [\"ro\", \"română\"],\n    [\"ru\", \"русский\"],\n    [\"si\", \"සිංහල\"],\n    [\"sk\", \"slovenčina\"],\n    [\"sl\", \"Slovenski jezik, Slovenščina\"],\n    [\"sr\", \"Српски\"],\n    [\"sv\", \"svenska\"],\n    [\"th\", \"ไทย\"],\n    [\"tr\", \"Türkçe\"],\n    [\"uk\", \"українська\"],\n    [\"vi\", \"Tiếng Việt\"],\n    [\"zh-CN\", \"中文（中国大陆）\"],\n    [\"zh-TW\", \"中文（台灣）\"],\n  ]);\n\n  protected inited: boolean;\n  protected defaultMessages: any = {};\n  protected localeMessages: any = {};\n\n  constructor(\n    protected systemLanguage: string,\n    protected localesDirectory: string,\n    protected getLocalesJson: (formattedLocale: string) => Promise<any>\n  ) {\n    this.systemLanguage = systemLanguage.replace(\"_\", \"-\");\n  }\n\n  async init(locale?: string) {\n    if (this.inited) {\n      throw new Error(\"i18n already initialized.\");\n    }\n    if (this.supportedTranslationLocales == null || this.supportedTranslationLocales.length === 0) {\n      throw new Error(\"supportedTranslationLocales not set.\");\n    }\n\n    this.inited = true;\n    this.translationLocale = locale != null ? locale : this.systemLanguage;\n\n    try {\n      this.collator = new Intl.Collator(this.translationLocale, {\n        numeric: true,\n        sensitivity: \"base\",\n      });\n    } catch {\n      this.collator = null;\n    }\n\n    if (this.supportedTranslationLocales.indexOf(this.translationLocale) === -1) {\n      this.translationLocale = this.translationLocale.slice(0, 2);\n\n      if (this.supportedTranslationLocales.indexOf(this.translationLocale) === -1) {\n        this.translationLocale = this.defaultLocale;\n      }\n    }\n\n    if (this.localesDirectory != null) {\n      await this.loadMessages(this.translationLocale, this.localeMessages);\n      if (this.translationLocale !== this.defaultLocale) {\n        await this.loadMessages(this.defaultLocale, this.defaultMessages);\n      }\n    }\n  }\n\n  t(id: string, p1?: string, p2?: string, p3?: string): string {\n    return this.translate(id, p1, p2, p3);\n  }\n\n  translate(id: string, p1?: string | number, p2?: string | number, p3?: string | number): string {\n    let result: string;\n    // eslint-disable-next-line\n    if (this.localeMessages.hasOwnProperty(id) && this.localeMessages[id]) {\n      result = this.localeMessages[id];\n      // eslint-disable-next-line\n    } else if (this.defaultMessages.hasOwnProperty(id) && this.defaultMessages[id]) {\n      result = this.defaultMessages[id];\n    } else {\n      result = \"\";\n    }\n\n    if (result !== \"\") {\n      if (p1 != null) {\n        result = result.split(\"__$1__\").join(p1.toString());\n      }\n      if (p2 != null) {\n        result = result.split(\"__$2__\").join(p2.toString());\n      }\n      if (p3 != null) {\n        result = result.split(\"__$3__\").join(p3.toString());\n      }\n    }\n\n    return result;\n  }\n\n  protected async loadMessages(locale: string, messagesObj: any): Promise<any> {\n    const formattedLocale = locale.replace(\"-\", \"_\");\n    const locales = await this.getLocalesJson(formattedLocale);\n    for (const prop in locales) {\n      // eslint-disable-next-line\n      if (!locales.hasOwnProperty(prop)) {\n        continue;\n      }\n      messagesObj[prop] = locales[prop].message;\n\n      if (locales[prop].placeholders) {\n        for (const placeProp in locales[prop].placeholders) {\n          if (\n            !locales[prop].placeholders.hasOwnProperty(placeProp) || // eslint-disable-line\n            !locales[prop].placeholders[placeProp].content\n          ) {\n            continue;\n          }\n\n          const replaceToken = \"\\\\$\" + placeProp.toUpperCase() + \"\\\\$\";\n          let replaceContent = locales[prop].placeholders[placeProp].content;\n          if (replaceContent === \"$1\" || replaceContent === \"$2\" || replaceContent === \"$3\") {\n            replaceContent = \"__$\" + replaceContent + \"__\";\n          }\n          messagesObj[prop] = messagesObj[prop].replace(\n            new RegExp(replaceToken, \"g\"),\n            replaceContent\n          );\n        }\n      }\n    }\n  }\n}\n","import { b64Decode, getQsParam } from \"./common\";\nimport { buildDataString, parseWebauthnJson } from \"./common-webauthn\";\nimport { TranslationService } from \"./translation.service\";\n\nrequire(\"./webauthn.scss\");\n\nlet parsed = false;\nlet webauthnJson: any;\nlet parentUrl: string = null;\nlet sentSuccess = false;\nlet locale: string = null;\nlet localeService: TranslationService = null;\n\nfunction parseParameters() {\n  if (parsed) {\n    return;\n  }\n\n  parentUrl = getQsParam(\"parent\");\n  if (!parentUrl) {\n    error(\"No parent.\");\n    return;\n  } else {\n    parentUrl = decodeURIComponent(parentUrl);\n  }\n\n  locale = getQsParam(\"locale\") ?? \"en\";\n\n  const version = getQsParam(\"v\");\n\n  if (version === \"1\") {\n    parseParametersV1();\n  } else {\n    parseParametersV2();\n  }\n  parsed = true;\n}\n\nfunction parseParametersV1() {\n  const data = getQsParam(\"data\");\n  if (!data) {\n    error(\"No data.\");\n    return;\n  }\n\n  webauthnJson = b64Decode(data);\n}\n\nfunction parseParametersV2() {\n  let dataObj: { data: any; btnText: string } = null;\n  try {\n    dataObj = JSON.parse(b64Decode(getQsParam(\"data\")));\n  } catch (e) {\n    error(\"Cannot parse data.\");\n    return;\n  }\n\n  webauthnJson = dataObj.data;\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", async () => {\n  parseParameters();\n  try {\n    localeService = new TranslationService(locale, \"locales\");\n  } catch {\n    error(\"Failed to load the provided locale \" + locale);\n    localeService = new TranslationService(\"en\", \"locales\");\n  }\n\n  await localeService.init();\n\n  document.getElementById(\"msg\").innerText = localeService.t(\"webAuthnFallbackMsg\");\n  document.getElementById(\"remember-label\").innerText = localeService.t(\"rememberMe\");\n\n  const button = document.getElementById(\"webauthn-button\");\n  button.innerText = localeService.t(\"webAuthnAuthenticate\");\n  button.onclick = start;\n\n  document.getElementById(\"spinner\").classList.add(\"d-none\");\n  const content = document.getElementById(\"content\");\n  content.classList.add(\"d-block\");\n  content.classList.remove(\"d-none\");\n});\n\nfunction start() {\n  if (sentSuccess) {\n    return;\n  }\n\n  if (!(\"credentials\" in navigator)) {\n    error(localeService.t(\"webAuthnNotSupported\"));\n    return;\n  }\n\n  parseParameters();\n  if (!webauthnJson) {\n    error(\"No data.\");\n    return;\n  }\n\n  let json: any;\n  try {\n    json = parseWebauthnJson(webauthnJson);\n  } catch (e) {\n    error(\"Cannot parse data.\");\n    return;\n  }\n\n  initWebAuthn(json);\n}\n\nasync function initWebAuthn(obj: any) {\n  try {\n    const assertedCredential = (await navigator.credentials.get({\n      publicKey: obj,\n    })) as PublicKeyCredential;\n\n    if (sentSuccess) {\n      return;\n    }\n\n    const dataString = buildDataString(assertedCredential);\n    const remember = (document.getElementById(\"remember\") as HTMLInputElement).checked;\n    window.postMessage({ command: \"webAuthnResult\", data: dataString, remember: remember }, \"*\");\n\n    sentSuccess = true;\n    success(localeService.t(\"webAuthnSuccess\"));\n  } catch (err) {\n    error(err);\n  }\n}\n\nfunction error(message: string) {\n  const el = document.getElementById(\"msg\");\n  resetMsgBox(el);\n  el.textContent = message;\n  el.classList.add(\"alert\");\n  el.classList.add(\"alert-danger\");\n}\n\nfunction success(message: string) {\n  (document.getElementById(\"webauthn-button\") as HTMLButtonElement).disabled = true;\n\n  const el = document.getElementById(\"msg\");\n  resetMsgBox(el);\n  el.textContent = message;\n  el.classList.add(\"alert\");\n  el.classList.add(\"alert-success\");\n}\n\nfunction resetMsgBox(el: HTMLElement) {\n  el.classList.remove(\"alert\");\n  el.classList.remove(\"alert-danger\");\n  el.classList.remove(\"alert-success\");\n}\n"],"names":["__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","r","Symbol","toStringTag","Object","defineProperty","value","getQsParam","name","url","window","location","href","replace","results","RegExp","exec","decodeURIComponent","b64Decode","str","spaceAsPlus","Array","prototype","map","call","atob","c","charCodeAt","toString","slice","join","coerceToBase64Url","thing","isArray","Uint8Array","from","ArrayBuffer","len","byteLength","i","String","fromCharCode","btoa","Error","SupportedTranslationLocales","TranslationService","constructor","systemLanguage","localesDirectory","getLocalesJson","supportedTranslationLocales","defaultLocale","localeNames","Map","defaultMessages","localeMessages","this","init","locale","inited","length","translationLocale","collator","Intl","Collator","numeric","sensitivity","indexOf","loadMessages","t","id","p1","p2","p3","translate","result","hasOwnProperty","split","messagesObj","formattedLocale","locales","prop","message","placeholders","placeProp","content","replaceToken","toUpperCase","replaceContent","super","filePath","localesResult","fetch","json","_translationLocale","webauthnJson","parsed","parentUrl","sentSuccess","localeService","parseParameters","error","data","parseParametersV1","dataObj","JSON","parse","e","parseParametersV2","start","navigator","jsonString","challenge","allowCredentials","forEach","listItem","fixedId","parseWebauthnJson","obj","assertedCredential","credentials","get","publicKey","dataString","response","authData","authenticatorData","clientDataJSON","rawId","sig","signature","type","extensions","getClientExtensionResults","clientDataJson","stringify","buildDataString","remember","document","getElementById","checked","postMessage","command","disabled","el","resetMsgBox","textContent","classList","add","success","err","initWebAuthn","remove","addEventListener","innerText","button","onclick"],"sourceRoot":""}