"use strict";(self.webpackChunk_bitwarden_web_vault=self.webpackChunk_bitwarden_web_vault||[]).push([[126],{56992:(e,i,t)=>{t.d(i,{S:()=>s});var n=t(58691),o=t(24852),r=t(25158),l=function(e,i,t,n){return new(t||(t=Promise))((function(o,r){function l(e){try{c(n.next(e))}catch(i){r(i)}}function s(e){try{c(n.throw(e))}catch(i){r(i)}}function c(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(l,s)}c((n=n.apply(e,i||[])).next())}))};class s{constructor(e,i){this.router=e,this.organizationService=i}canActivate(e,i){var t;return l(this,void 0,void 0,(function*(){const o=this.organizationService.get(e.params.organizationId),r=null===(t=e.data)||void 0===t?void 0:t.autoRedirectCallback;if(r){let e=r(o);return"string"==typeof e&&(e=[e]),this.router.createUrlTree([i.url,...e])}return(0,n.gW)(o)?this.router.createUrlTree(["/organizations",o.id]):this.router.createUrlTree(["/"])}))}}s.ɵfac=function(e){return new(e||s)(o.LFG(r.F0),o.LFG(n.Mn))},s.ɵprov=o.Yz7({token:s,factory:s.ɵfac,providedIn:"root"})},86126:(e,i,t)=>{t.r(i),t.d(i,{OrganizationModule:()=>nn});var n,o,r=t(75105),l=t(25158),s=t(78493),c=t(58691),a=t(47064),u=t(56992),d=t(35660),h=t(24852),p=t(54019),g=t(59554),f=t(80060),m=t(30359),v=t(33031),b=t(59260),U=t(59157),Z=t(92786),_=t(68362),w=t(70032),A=t(19887),y=t(5712),x=t(43493),C=t(77494),T=t(27646),S=t(68134),I=t(54193),q=t(65017),z=t(98645),M=t(92716),J=t(79596),F=t(25679),O=t(14309),L=t(55602),Y=t(80361),N=t(78627),G=t(31754),k=t(99721),D=t(66459),$=t(19419),Q=t(33245),P=t(62374),E=t(98205),R=t(46246),B=t(36338),j=t(81974),H=t(29465),K=t(18362),W=t(24637),V=t(11512),X=t(36179),ee=t(44358),ie=t(21656),te=t(17731),ne=t(26536),oe=t(36689),re=t(82933),le=function(e,i,t,n){return new(t||(t=Promise))((function(o,r){function l(e){try{c(n.next(e))}catch(i){r(i)}}function s(e){try{c(n.throw(e))}catch(i){r(i)}}function c(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(l,s)}c((n=n.apply(e,i||[])).next())}))};function se(e,i){if(1&e&&(h.TgZ(0,"span",11),h._uU(1),h.qZA()),2&e){const e=h.oxw();h.xp6(1),h.Oqu(null==e.group?null:e.group.name)}}function ce(e,i){1&e&&(h.TgZ(0,"div"),h._uU(1,"\n        "),h._UZ(2,"i",12),h.ALo(3,"i18n"),h._uU(4,"\n        "),h.TgZ(5,"span",13),h._uU(6),h.ALo(7,"i18n"),h.qZA(),h._uU(8,"\n      "),h.qZA()),2&e&&(h.xp6(2),h.s9C("title",h.lcZ(3,2,"loading")),h.xp6(4),h.Oqu(h.lcZ(7,4,"loading")))}function ae(e,i){if(1&e&&(h.ynx(0),h._uU(1,"\n            "),h._UZ(2,"bit-access-selector",23),h.ALo(3,"i18n"),h.ALo(4,"i18n"),h.ALo(5,"i18n"),h._uU(6,"\n          "),h.BQk()),2&e){const e=h.oxw(2);h.xp6(2),h.Q6J("items",e.collections)("permissionMode",e.PermissionMode.Edit)("columnHeader",h.lcZ(3,5,"collection"))("selectorLabelText",h.lcZ(4,7,"selectCollections"))("emptySelectionText",h.lcZ(5,9,"noCollectionsAdded"))}}function ue(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"bit-tab-group",14),h.NdJ("selectedIndexChange",(function(i){h.CHM(e);const t=h.oxw();return h.KtG(t.tabIndex=i)})),h._uU(1,"\n        "),h.TgZ(2,"bit-tab",15),h.ALo(3,"i18n"),h._uU(4,"\n          "),h.TgZ(5,"bit-form-field"),h._uU(6,"\n            "),h.TgZ(7,"bit-label"),h._uU(8),h.ALo(9,"i18n"),h.qZA(),h._uU(10,"\n            "),h._UZ(11,"input",16),h._uU(12,"\n            "),h.TgZ(13,"bit-hint"),h._uU(14),h.ALo(15,"i18n"),h.qZA(),h._uU(16,"\n          "),h.qZA(),h._uU(17,"\n          "),h.TgZ(18,"bit-form-field"),h._uU(19,"\n            "),h.TgZ(20,"bit-label"),h._uU(21),h.ALo(22,"i18n"),h.qZA(),h._uU(23,"\n            "),h._UZ(24,"input",17),h._uU(25,"\n            "),h.TgZ(26,"bit-hint"),h._uU(27),h.ALo(28,"i18n"),h.qZA(),h._uU(29,"\n          "),h.qZA(),h._uU(30,"\n        "),h.qZA(),h._uU(31,"\n\n        "),h.TgZ(32,"bit-tab",15),h.ALo(33,"i18n"),h._uU(34,"\n          "),h.TgZ(35,"p"),h._uU(36),h.ALo(37,"i18n"),h.qZA(),h._uU(38,"\n          "),h._UZ(39,"bit-access-selector",18),h.ALo(40,"i18n"),h.ALo(41,"i18n"),h.ALo(42,"i18n"),h._uU(43,"\n        "),h.qZA(),h._uU(44,"\n\n        "),h.TgZ(45,"bit-tab",15),h.ALo(46,"i18n"),h._uU(47,"\n          "),h.TgZ(48,"p"),h._uU(49),h.ALo(50,"i18n"),h.qZA(),h._uU(51,"\n          "),h.TgZ(52,"div",19),h._uU(53,"\n            "),h._UZ(54,"input",20),h._uU(55,"\n            "),h.TgZ(56,"label",21),h._uU(57),h.ALo(58,"i18n"),h.qZA(),h._uU(59,"\n            "),h.TgZ(60,"p",22),h._uU(61),h.ALo(62,"i18n"),h.qZA(),h._uU(63,"\n          "),h.qZA(),h._uU(64,"\n          "),h.YNc(65,ae,7,11,"ng-container",5),h._uU(66,"\n        "),h.qZA(),h._uU(67,"\n      "),h.qZA()}if(2&e){const e=h.oxw();h.Q6J("selectedIndex",e.tabIndex),h.xp6(2),h.s9C("label",h.lcZ(3,19,"groupInfo")),h.xp6(6),h.Oqu(h.lcZ(9,21,"name")),h.xp6(6),h.Oqu(h.xi3(15,23,"characterMaximum",100)),h.xp6(7),h.Oqu(h.lcZ(22,26,"externalId")),h.xp6(6),h.Oqu(h.lcZ(28,28,"externalIdDesc")),h.xp6(5),h.s9C("label",h.lcZ(33,30,"members")),h.xp6(4),h.Oqu(h.lcZ(37,32,"editGroupMembersDesc")),h.xp6(3),h.Q6J("items",e.members)("showMemberRoles",!0)("permissionMode",e.PermissionMode.Hidden)("columnHeader",h.lcZ(40,34,"member"))("selectorLabelText",h.lcZ(41,36,"selectMembers"))("emptySelectionText",h.lcZ(42,38,"noMembersAdded")),h.xp6(6),h.s9C("label",h.lcZ(46,40,"collections")),h.xp6(4),h.Oqu(h.lcZ(50,42,"editGroupCollectionsDesc")),h.xp6(8),h.Oqu(h.lcZ(58,44,"accessAllCollectionsDesc")),h.xp6(4),h.Oqu(h.lcZ(62,46,"accessAllCollectionsHelp")),h.xp6(4),h.Q6J("ngIf",!e.groupForm.value.accessAll)}}!function(e){e[e.Info=0]="Info",e[e.Members=1]="Members",e[e.Collections=2]="Collections"}(n||(n={})),function(e){e.Saved="saved",e.Canceled="canceled",e.Deleted="deleted"}(o||(o={}));class de{get groupId(){return this.params.groupId}get organizationId(){return this.params.organizationId}get orgCollections$(){return(0,b.D)(this.apiService.getCollections(this.organizationId)).pipe((0,m.w)((e=>(0,b.D)(this.collectionService.decryptMany(e.data.map((e=>new I.F(new S.Z(e)))))))),(0,Z.U)((e=>e.map((e=>({id:e.id,type:O.zD.Collection,labelName:e.name,listName:e.name}))))))}get orgMembers$(){return(0,b.D)(this.organizationUserService.getAllUsers(this.organizationId)).pipe((0,Z.U)((e=>e.data.map((e=>{var i;return{id:e.id,type:O.zD.Member,email:e.email,role:e.type,listName:(null===(i=e.name)||void 0===i?void 0:i.length)>0?`${e.name} (${e.email})`:e.email,labelName:e.name||e.email,status:e.status}})))))}get groupDetails$(){return this.editMode?(0,v.a)([this.groupService.get(this.organizationId,this.groupId),this.apiService.getGroupUsers(this.organizationId,this.groupId)]).pipe((0,Z.U)((([e,i])=>(e.members=i,e))),(0,J.K)((e=>(e instanceof F.i?this.logService.error(e.message):this.logService.error(e.toString()),(0,M.of)(void 0))))):(0,M.of)(void 0)}constructor(e,i,t,l,s,c,a,u,d,h,g,f){var m;this.params=e,this.dialogRef=i,this.apiService=t,this.organizationUserService=l,this.groupService=s,this.i18nService=c,this.collectionService=a,this.platformUtilsService=u,this.logService=d,this.formBuilder=h,this.changeDetectorRef=g,this.dialogService=f,this.PermissionMode=O.R9,this.ResultType=o,this.loading=!0,this.editMode=!1,this.collections=[],this.members=[],this.groupForm=this.formBuilder.group({accessAll:[!1],name:["",[z.kI.required,z.kI.maxLength(100)]],externalId:this.formBuilder.control({value:"",disabled:!0}),members:[[]],collections:[[]]}),this.destroy$=new p.x,this.submit=()=>le(this,void 0,void 0,(function*(){var e,i;if(this.groupForm.markAllAsTouched(),this.groupForm.invalid)return void(this.tabIndex!==n.Info&&this.platformUtilsService.showToast("error",null,this.i18nService.t("fieldOnTabRequiresAttention",this.i18nService.t("groupInfo"))));const t=new r.Rq;t.id=this.groupId,t.organizationId=this.organizationId;const l=this.groupForm.value;t.name=l.name,t.accessAll=l.accessAll,t.members=null!==(i=null===(e=l.members)||void 0===e?void 0:e.map((e=>e.id)))&&void 0!==i?i:[],t.accessAll||(t.collections=l.collections.map((e=>(0,O.E2)(e)))),yield this.groupService.save(t),this.platformUtilsService.showToast("success",null,this.i18nService.t(this.editMode?"editedGroupId":"createdGroupId",l.name)),this.dialogRef.close(o.Saved)})),this.delete=()=>le(this,void 0,void 0,(function*(){if(!this.editMode)return;if(!(yield this.dialogService.openSimpleDialog({title:this.group.name,content:{key:"deleteGroupConfirmation"},type:x.rC.WARNING})))return!1;yield this.groupService.delete(this.organizationId,this.groupId),this.platformUtilsService.showToast("success",null,this.i18nService.t("deletedGroupId",this.group.name)),this.dialogRef.close(o.Deleted)})),this.tabIndex=null!==(m=e.initialTab)&&void 0!==m?m:n.Info}ngOnInit(){this.editMode=this.loading=null!=this.groupId,this.title=this.i18nService.t(this.editMode?"editGroup":"newGroup"),(0,v.a)([this.orgCollections$,this.orgMembers$,this.groupDetails$]).pipe((0,_.R)(this.destroy$)).subscribe((([e,i,t])=>{this.collections=e,this.members=i,this.group=t,null!=this.group&&(this.changeDetectorRef.detectChanges(),this.groupForm.patchValue({name:this.group.name,externalId:this.group.externalId,accessAll:this.group.accessAll,members:this.group.members.map((e=>({id:e,type:O.zD.Member}))),collections:this.group.collections.map((e=>({id:e.id,type:O.zD.Collection,permission:(0,O.d4)(e)})))})),this.loading=!1}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}de.ɵfac=function(e){return new(e||de)(h.Y36(q.Kt),h.Y36(q.zj),h.Y36(L.s),h.Y36(Y.t),h.Y36(r.My),h.Y36(N.D),h.Y36(G.a),h.Y36(k.P),h.Y36(D.$),h.Y36(z.qu),h.Y36(h.sBO),h.Y36(x.eo))},de.ɵcmp=h.Xpm({type:de,selectors:[["app-group-add-edit"]],decls:32,vars:18,consts:[[3,"formGroup","bitSubmit"],["dialogSize","large",3,"disablePadding"],["bitDialogTitle",""],["class","tw-text-sm tw-normal-case tw-text-muted",4,"ngIf"],["bitDialogContent",""],[4,"ngIf"],[3,"selectedIndex","selectedIndexChange",4,"ngIf"],["bitDialogFooter",""],["bitButton","","buttonType","primary","bitFormButton","","type","submit"],["bitButton","","buttonType","secondary","type","button","bitDialogClose","",3,"bit-dialog-close"],["type","button","buttonType","danger","bitIconButton","bwi-trash","bitFormButton","",1,"tw-ml-auto",3,"bitAction","appA11yTitle"],[1,"tw-text-sm","tw-normal-case","tw-text-muted"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","text-muted",3,"title"],[1,"sr-only"],[3,"selectedIndex","selectedIndexChange"],[3,"label"],["bitInput","","appAutofocus","","type","text","formControlName","name"],["bitInput","","type","text","formControlName","externalId"],["formControlName","members",3,"items","showMemberRoles","permissionMode","columnHeader","selectorLabelText","emptySelectionText"],[1,"tw-my-3"],["type","checkbox","formControlName","accessAll","id","accessAll"],["for","accessAll",1,"tw-mb-0","tw-text-lg"],[1,"tw-my-0","tw-text-muted"],["formControlName","collections",3,"items","permissionMode","columnHeader","selectorLabelText","emptySelectionText"]],template:function(e,i){1&e&&(h.TgZ(0,"form",0),h._uU(1,"\n  "),h.TgZ(2,"bit-dialog",1),h._uU(3,"\n    "),h.TgZ(4,"span",2),h._uU(5),h.YNc(6,se,2,1,"span",3),h._uU(7,"\n    "),h.qZA(),h._uU(8,"\n    "),h.TgZ(9,"div",4),h._uU(10,"\n      "),h.YNc(11,ce,9,6,"div",5),h._uU(12,"\n\n      "),h.YNc(13,ue,68,48,"bit-tab-group",6),h._uU(14,"\n    "),h.qZA(),h._uU(15,"\n    "),h.ynx(16,7),h._uU(17,"\n      "),h.TgZ(18,"button",8),h._uU(19),h.ALo(20,"i18n"),h.qZA(),h._uU(21,"\n      "),h.TgZ(22,"button",9),h._uU(23),h.ALo(24,"i18n"),h.qZA(),h._uU(25,"\n      "),h._UZ(26,"button",10),h.ALo(27,"i18n"),h._uU(28,"\n    "),h.BQk(),h._uU(29,"\n  "),h.qZA(),h._uU(30,"\n"),h.qZA(),h._uU(31,"\n")),2&e&&(h.Q6J("formGroup",i.groupForm)("bitSubmit",i.submit),h.xp6(2),h.Q6J("disablePadding",!i.loading),h.xp6(3),h.hij("\n      ",i.title,"\n      "),h.xp6(1),h.Q6J("ngIf",i.editMode),h.xp6(5),h.Q6J("ngIf",i.loading),h.xp6(2),h.Q6J("ngIf",!i.loading),h.xp6(6),h.hij("\n        ",h.lcZ(20,12,"save"),"\n      "),h.xp6(3),h.Q6J("bit-dialog-close",i.ResultType.Canceled),h.xp6(1),h.hij("\n        ",h.lcZ(24,14,"cancel"),"\n      "),h.xp6(3),h.Q6J("bitAction",i.delete)("appA11yTitle",h.lcZ(27,16,"delete")))},dependencies:[$.O5,z._Y,z.Fj,z.Wl,z.JJ,z.JL,z.sg,z.u,Q.B,P.U,E.Q,R.b,B.u,j.r,H.a,K.f,W.d,V.G,X.u,ee.M,ie.Q,te.Q,ne.i,oe.f,re.C],encapsulation:2});var he=t(51430),pe=t(56617),ge=t(1874),fe=t(7172),me=t(12492),ve=t(73974),be=t(26194),Ue=t(44234),Ze=t(54735),_e=t(50941),we=t(26361),Ae=function(e,i,t,n){return new(t||(t=Promise))((function(o,r){function l(e){try{c(n.next(e))}catch(i){r(i)}}function s(e){try{c(n.throw(e))}catch(i){r(i)}}function c(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(l,s)}c((n=n.apply(e,i||[])).next())}))};const ye=["addEdit"],xe=["usersTemplate"];function Ce(e,i){1&e&&(h.ynx(0),h._uU(1,"\n    "),h._UZ(2,"i",12),h.ALo(3,"i18n"),h._uU(4,"\n    "),h.TgZ(5,"span",4),h._uU(6),h.ALo(7,"i18n"),h.qZA(),h._uU(8,"\n  "),h.BQk()),2&e&&(h.xp6(2),h.s9C("title",h.lcZ(3,2,"loading")),h.xp6(4),h.Oqu(h.lcZ(7,4,"loading")))}function Te(e,i){1&e&&(h.TgZ(0,"p"),h._uU(1),h.ALo(2,"i18n"),h.qZA()),2&e&&(h.xp6(1),h.Oqu(h.lcZ(2,1,"noGroupsInList")))}function Se(e,i){if(1&e&&h._UZ(0,"bit-badge-list",38),2&e){const e=h.oxw().$implicit;h.Q6J("items",e.collectionNames)("maxItems",3)}}function Ie(e,i){1&e&&(h.TgZ(0,"span"),h._uU(1),h.ALo(2,"i18n"),h.qZA()),2&e&&(h.xp6(1),h.Oqu(h.lcZ(2,1,"all")))}function qe(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"tr",28),h._uU(1,"\n          "),h.TgZ(2,"td",29),h.NdJ("click",(function(){const i=h.CHM(e).$implicit,t=h.oxw(4);return h.KtG(t.check(i))})),h._uU(3,"\n            "),h.TgZ(4,"input",30),h.NdJ("ngModelChange",(function(i){const t=h.CHM(e).$implicit;return h.KtG(t.checked=i)})),h.qZA(),h._uU(5,"\n          "),h.qZA(),h._uU(6,"\n          "),h.TgZ(7,"td",31),h.NdJ("click",(function(){const i=h.CHM(e).$implicit,t=h.oxw(4);return h.KtG(t.edit(i))})),h._uU(8,"\n            "),h.TgZ(9,"button",32),h._uU(10),h.qZA(),h._uU(11,"\n          "),h.qZA(),h._uU(12,"\n          "),h.TgZ(13,"td",29),h.NdJ("click",(function(){const i=h.CHM(e).$implicit,t=h.oxw(4);return h.KtG(t.edit(i,t.ModalTabType.Collections))})),h._uU(14,"\n            "),h.YNc(15,Se,1,2,"bit-badge-list",33),h._uU(16,"\n            "),h.YNc(17,Ie,3,3,"span",10),h._uU(18,"\n          "),h.qZA(),h._uU(19,"\n          "),h.TgZ(20,"td",19),h._uU(21,"\n            "),h._UZ(22,"button",21),h.ALo(23,"i18n"),h._uU(24,"\n\n            "),h.TgZ(25,"bit-menu",null,34),h._uU(27,"\n              "),h.TgZ(28,"button",23),h.NdJ("click",(function(){const i=h.CHM(e).$implicit,t=h.oxw(4);return h.KtG(t.edit(i))})),h._uU(29,"\n                "),h._UZ(30,"i",35),h._uU(31),h.ALo(32,"i18n"),h.qZA(),h._uU(33,"\n              "),h.TgZ(34,"button",23),h.NdJ("click",(function(){const i=h.CHM(e).$implicit,t=h.oxw(4);return h.KtG(t.edit(i,t.ModalTabType.Members))})),h._uU(35,"\n                "),h._UZ(36,"i",36),h._uU(37),h.ALo(38,"i18n"),h.qZA(),h._uU(39,"\n              "),h.TgZ(40,"button",23),h.NdJ("click",(function(){const i=h.CHM(e).$implicit,t=h.oxw(4);return h.KtG(t.edit(i,t.ModalTabType.Collections))})),h._uU(41,"\n                "),h._UZ(42,"i",37),h._uU(43),h.ALo(44,"i18n"),h.qZA(),h._uU(45,"\n              "),h.TgZ(46,"button",23),h.NdJ("click",(function(){const i=h.CHM(e).$implicit,t=h.oxw(4);return h.KtG(t.delete(i))})),h._uU(47,"\n                "),h.TgZ(48,"span",24),h._UZ(49,"i",25),h._uU(50),h.ALo(51,"i18n"),h.qZA(),h._uU(52,"\n              "),h.qZA(),h._uU(53,"\n            "),h.qZA(),h._uU(54,"\n          "),h.qZA(),h._uU(55,"\n        "),h.qZA()}if(2&e){const e=i.$implicit,t=h.MAs(26);h.xp6(4),h.Q6J("ngModel",e.checked),h.xp6(6),h.hij("\n              ",e.details.name,"\n            "),h.xp6(5),h.Q6J("ngIf",!e.details.accessAll),h.xp6(2),h.Q6J("ngIf",e.details.accessAll),h.xp6(5),h.s9C("appA11yTitle",h.lcZ(23,10,"options")),h.Q6J("bitMenuTriggerFor",t),h.xp6(9),h.hij(" ",h.lcZ(32,12,"editInfo"),"\n              "),h.xp6(6),h.hij(" ",h.lcZ(38,14,"members"),"\n              "),h.xp6(6),h.hij(" ",h.lcZ(44,16,"collections"),"\n              "),h.xp6(7),h.hij(" ",h.lcZ(51,18,"delete"),"")}}function ze(e,i){if(1&e&&(h._uU(0,"\n        "),h.YNc(1,qe,56,20,"tr",27),h._uU(2,"\n      ")),2&e){const e=h.oxw(3);h.xp6(1),h.Q6J("ngForOf",e.visibleGroups)}}function Me(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"bit-table",14),h.NdJ("scrolled",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.loadMore())})),h._uU(1,"\n      "),h.ynx(2,15),h._uU(3,"\n        "),h.TgZ(4,"tr"),h._uU(5,"\n          "),h.TgZ(6,"th",16),h._uU(7,"\n            "),h.TgZ(8,"input",17),h.NdJ("change",(function(i){h.CHM(e);const t=h.oxw(2);return h.KtG(t.toggleAllVisible(i))})),h.qZA(),h._uU(9,"\n            "),h.TgZ(10,"label",18),h._uU(11),h.ALo(12,"i18n"),h.qZA(),h._uU(13,"\n          "),h.qZA(),h._uU(14,"\n          "),h.TgZ(15,"th",19),h._uU(16),h.ALo(17,"i18n"),h.qZA(),h._uU(18,"\n          "),h.TgZ(19,"th",19),h._uU(20),h.ALo(21,"i18n"),h.qZA(),h._uU(22,"\n          "),h.TgZ(23,"th",20),h._uU(24,"\n            "),h._UZ(25,"button",21),h.ALo(26,"i18n"),h._uU(27,"\n\n            "),h.TgZ(28,"bit-menu",null,22),h._uU(30,"\n              "),h.TgZ(31,"button",23),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.deleteAllSelected())})),h._uU(32,"\n                "),h.TgZ(33,"span",24),h._UZ(34,"i",25),h._uU(35),h.ALo(36,"i18n"),h.qZA(),h._uU(37,"\n              "),h.qZA(),h._uU(38,"\n            "),h.qZA(),h._uU(39,"\n          "),h.qZA(),h._uU(40,"\n        "),h.qZA(),h._uU(41,"\n      "),h.BQk(),h._uU(42,"\n      "),h.YNc(43,ze,3,1,"ng-template",26),h._uU(44,"\n    "),h.qZA()}if(2&e){const e=h.MAs(29),i=h.oxw(2);h.Q6J("infiniteScrollDistance",1)("infiniteScrollDisabled",!i.isPaging()),h.xp6(11),h.Oqu(h.lcZ(12,8,"all")),h.xp6(5),h.Oqu(h.lcZ(17,10,"name")),h.xp6(4),h.Oqu(h.lcZ(21,12,"collections")),h.xp6(5),h.s9C("appA11yTitle",h.lcZ(26,14,"options")),h.Q6J("bitMenuTriggerFor",e),h.xp6(10),h.hij(" ",h.lcZ(36,16,"delete"),"")}}function Je(e,i){if(1&e&&(h.ynx(0),h._uU(1,"\n    "),h.YNc(2,Te,3,3,"p",10),h._uU(3,"\n    "),h.YNc(4,Me,45,18,"bit-table",13),h._uU(5,"\n  "),h.BQk()),2&e){const e=h.oxw();h.xp6(2),h.Q6J("ngIf",!e.visibleGroups.length),h.xp6(2),h.Q6J("ngIf",e.visibleGroups.length)}}function Fe(e,i){}class Oe{get searchText(){return this._searchText}set searchText(e){this._searchText=e,this.updateSearchedGroups()}get visibleGroups(){return this.isPaging()?this.pagedGroups:this.isSearching()?this.searchedGroups:this.groups}constructor(e,i,t,o,r,l,s,c,a,u,d){this.apiService=e,this.groupService=i,this.route=t,this.i18nService=o,this.modalService=r,this.dialogService=l,this.platformUtilsService=s,this.searchService=c,this.logService=a,this.collectionService=u,this.searchPipe=d,this.loading=!0,this.didScroll=!1,this.pageSize=100,this.ModalTabType=n,this.pagedGroupsCount=0,this.destroy$=new p.x,this.refreshGroups$=new g.X(null)}ngOnInit(){return Ae(this,void 0,void 0,(function*(){this.route.params.pipe((0,f.b)((e=>this.organizationId=e.organizationId)),(0,m.w)((()=>(0,v.a)([(0,b.D)(this.apiService.getCollections(this.organizationId)).pipe((0,U.b)((e=>this.toCollectionMap(e)))),this.refreshGroups$.pipe((0,m.w)((()=>this.groupService.getAll(this.organizationId))))]))),(0,Z.U)((([e,i])=>i.sort(T.c.getSortFunction(this.i18nService,"name")).map((i=>{var t;return{id:i.id,name:i.name,details:i,checked:!1,collectionNames:i.collections.map((i=>{var t;return null===(t=e[i.id])||void 0===t?void 0:t.name})).sort(null===(t=this.i18nService.collator)||void 0===t?void 0:t.compare)}})))),(0,_.R)(this.destroy$)).subscribe((e=>{this.groups=e,this.resetPaging(),this.updateSearchedGroups(),this.loading=!1})),this.route.queryParams.pipe((0,A.P)(),(0,U.b)((e=>Ae(this,void 0,void 0,(function*(){this.searchText=e.search})))),(0,_.R)(this.destroy$)).subscribe()}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadMore(){if(!this.groups||this.groups.length<=this.pageSize)return;const e=this.pagedGroups.length;let i=this.pageSize;0===e&&this.pagedGroupsCount>this.pageSize&&(i=this.pagedGroupsCount),this.groups.length>e&&(this.pagedGroups=this.pagedGroups.concat(this.groups.slice(e,e+i))),this.pagedGroupsCount=this.pagedGroups.length,this.didScroll=this.pagedGroups.length>this.pageSize}edit(e,i=n.Info){return Ae(this,void 0,void 0,(function*(){const t=(n=this.dialogService,r={data:{initialTab:i,organizationId:this.organizationId,groupId:null!=e?e.details.id:null}},n.open(de,r));var n,r;const l=yield(0,w.n)(t.closed);l==o.Saved?this.refreshGroups$.next():l==o.Deleted&&this.removeGroup(e.details.id)}))}add(){this.edit(null)}delete(e){return Ae(this,void 0,void 0,(function*(){if(!(yield this.dialogService.openSimpleDialog({title:e.details.name,content:{key:"deleteGroupConfirmation"},type:x.rC.WARNING})))return!1;try{yield this.groupService.delete(this.organizationId,e.details.id),this.platformUtilsService.showToast("success",null,this.i18nService.t("deletedGroupId",e.details.name)),this.removeGroup(e.details.id)}catch(i){this.logService.error(i)}}))}deleteAllSelected(){return Ae(this,void 0,void 0,(function*(){const e=this.groups.filter((e=>e.checked));if(0==e.length)return;const i=e.map((e=>e.details.name)).join(", ");if(!(yield this.dialogService.openSimpleDialog({title:{key:"deleteMultipleGroupsConfirmation",placeholders:[e.length.toString()]},content:i,type:x.rC.WARNING})))return!1;try{yield this.groupService.deleteMany(this.organizationId,e.map((e=>e.details.id))),this.platformUtilsService.showToast("success",null,this.i18nService.t("deletedManyGroups",e.length.toString())),e.forEach((e=>this.removeGroup(e.details.id)))}catch(t){this.logService.error(t)}}))}resetPaging(){this.pagedGroups=[],this.loadMore()}isSearching(){return this.searchService.isSearchable(this.searchText)}check(e){e.checked=!e.checked}toggleAllVisible(e){this.visibleGroups.forEach((i=>i.checked=e.target.checked))}isPaging(){const e=this.isSearching();return e&&this.didScroll&&this.resetPaging(),!e&&this.groups&&this.groups.length>this.pageSize}removeGroup(e){const i=this.groups.findIndex((i=>i.details.id===e));i>-1&&(this.groups.splice(i,1),this.resetPaging(),this.updateSearchedGroups())}toCollectionMap(e){return Ae(this,void 0,void 0,(function*(){const i=e.data.map((e=>new I.F(new S.Z(e)))),t=yield this.collectionService.decryptMany(i),n={};return t.forEach((e=>n[e.id]=e)),n}))}updateSearchedGroups(){this.searchService.isSearchable(this.searchText)&&(this.searchedGroups=this.searchPipe.transform(this.groups,this.searchText,(e=>e.details.name),(e=>e.details.id)))}}Oe.ɵfac=function(e){return new(e||Oe)(h.Y36(L.s),h.Y36(r.My),h.Y36(l.gz),h.Y36(N.D),h.Y36(C.Z),h.Y36(x.eo),h.Y36(k.P),h.Y36(he.o),h.Y36(D.$),h.Y36(G.a),h.Y36(y.C))},Oe.ɵcmp=h.Xpm({type:Oe,selectors:[["app-org-groups"]],viewQuery:function(e,i){if(1&e&&(h.Gf(ye,7,h.s_b),h.Gf(xe,7,h.s_b)),2&e){let e;h.iGM(e=h.CRH())&&(i.addEditModalRef=e.first),h.iGM(e=h.CRH())&&(i.usersModalRef=e.first)}},decls:41,vars:15,consts:[[1,"container","page-content"],[1,"tw-mb-4","tw-flex"],[1,"tw-ml-auto","tw-flex","tw-items-center"],[1,"tw-mr-2"],[1,"sr-only"],[1,"tw-flex","tw-items-center"],["aria-hidden","true",1,"bwi","bwi-search","bwi-fw","tw-z-20","-tw-mr-7","tw-text-muted"],["bitInput","","type","search",1,"tw-rounded-l","tw-pl-9",3,"placeholder","ngModel","ngModelChange"],["bitButton","","type","button","buttonType","primary",3,"click"],["aria-hidden","true",1,"bwi","bwi-plus","bwi-fw"],[4,"ngIf"],["addEdit",""],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","text-muted",3,"title"],["infinite-scroll","",3,"infiniteScrollDistance","infiniteScrollDisabled","scrolled",4,"ngIf"],["infinite-scroll","",3,"infiniteScrollDistance","infiniteScrollDisabled","scrolled"],["header",""],["bitCell","",1,"tw-w-20"],["type","checkbox","bitCheckbox","","id","selectAll",1,"tw-mr-2",3,"change"],["for","selectAll",1,"tw-mb-0","!tw-font-bold","!tw-text-muted"],["bitCell",""],["bitCell","",1,"tw-w-10"],["type","button","bitIconButton","bwi-ellipsis-v","size","small",3,"bitMenuTriggerFor","appA11yTitle"],["headerMenu",""],["type","button","bitMenuItem","",3,"click"],[1,"tw-text-danger"],["aria-hidden","true",1,"bwi","bwi-trash"],["body",""],["bitRow","",4,"ngFor","ngForOf"],["bitRow",""],["bitCell","",1,"tw-cursor-pointer",3,"click"],["type","checkbox","bitCheckbox","",3,"ngModel","ngModelChange"],["bitCell","",1,"tw-cursor-pointer","tw-font-bold",3,"click"],["type","button","bitLink",""],["badgeType","secondary",3,"items","maxItems",4,"ngIf"],["rowMenu",""],["aria-hidden","true",1,"bwi","bwi-pencil-square"],["aria-hidden","true",1,"bwi","bwi-user"],["aria-hidden","true",1,"bwi","bwi-collection"],["badgeType","secondary",3,"items","maxItems"]],template:function(e,i){1&e&&(h.TgZ(0,"div",0),h._uU(1,"\n  "),h.TgZ(2,"div",1),h._uU(3,"\n    "),h.TgZ(4,"h1"),h._uU(5),h.ALo(6,"i18n"),h.qZA(),h._uU(7,"\n    "),h.TgZ(8,"div",2),h._uU(9,"\n      "),h.TgZ(10,"div",3),h._uU(11,"\n        "),h.TgZ(12,"label",4),h._uU(13),h.ALo(14,"i18n"),h.qZA(),h._uU(15,"\n        "),h.TgZ(16,"div",5),h._uU(17,"\n          "),h._UZ(18,"i",6),h._uU(19,"\n          "),h.TgZ(20,"input",7),h.NdJ("ngModelChange",(function(e){return i.searchText=e})),h.ALo(21,"i18n"),h.qZA(),h._uU(22,"\n        "),h.qZA(),h._uU(23,"\n      "),h.qZA(),h._uU(24,"\n      "),h.TgZ(25,"button",8),h.NdJ("click",(function(){return i.add()})),h._uU(26,"\n        "),h._UZ(27,"i",9),h._uU(28),h.ALo(29,"i18n"),h.qZA(),h._uU(30,"\n    "),h.qZA(),h._uU(31,"\n  "),h.qZA(),h._uU(32,"\n  "),h.YNc(33,Ce,9,6,"ng-container",10),h._uU(34,"\n  "),h.YNc(35,Je,6,2,"ng-container",10),h._uU(36,"\n  "),h.YNc(37,Fe,0,0,"ng-template",null,11,h.W1O),h._uU(39,"\n"),h.qZA(),h._uU(40,"\n")),2&e&&(h.xp6(5),h.Oqu(h.lcZ(6,7,"groups")),h.xp6(8),h.Oqu(h.lcZ(14,9,"search")),h.xp6(7),h.s9C("placeholder",h.lcZ(21,11,"searchGroups")),h.Q6J("ngModel",i.searchText),h.xp6(8),h.hij("\n        ",h.lcZ(29,13,"newGroup"),"\n      "),h.xp6(5),h.Q6J("ngIf",i.loading),h.xp6(2),h.Q6J("ngIf",!i.loading&&i.visibleGroups))},dependencies:[$.sg,$.O5,z.Fj,z.Wl,z.JJ,z.On,pe.Ry,Q.B,ge.b,j.r,fe.b,V.G,ie.Q,me._,ve.M,be.t,Ue.e,Ze.a,_e.Y,we.v,Ze.f,re.C],encapsulation:2});var Le=t(40857),Ye=t(99817),Ne=t(27406),Ge=t(63391),ke=t(21151),De=t(74690),$e=t(29176),Qe=t(16857),Pe=t(11667),Ee=t(75028),Re=t(98913),Be=t(56110),je=t(38595),He=t(51261),Ke=t(72530),We=t(23031),Ve=t(92236),Xe=t(83924),ei=function(e,i,t,n){return new(t||(t=Promise))((function(o,r){function l(e){try{c(n.next(e))}catch(i){r(i)}}function s(e){try{c(n.throw(e))}catch(i){r(i)}}function c(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(l,s)}c((n=n.apply(e,i||[])).next())}))};class ii extends Ke.n{constructor(e,i,t,n,o,r,l){super(e,i,t,n,o,r),this.collectionAdminService=l,this.destroy$=new p.x,this._collections=new Be.t(1),this.filteredCollections$=this._collections.asObservable(),this.collectionTree$=this.filteredCollections$.pipe((0,Z.U)((e=>this.buildCollectionTree(e))))}reloadCollections(e){return ei(this,void 0,void 0,(function*(){this._collections.next(e)}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}ii.ɵfac=function(e){return new(e||ii)(h.LFG(je.b2),h.LFG(c.Mn),h.LFG(We.s),h.LFG(Ve.u),h.LFG(Xe.d),h.LFG(N.D),h.LFG(He.m))},ii.ɵprov=h.Yz7({token:ii,factory:ii.ɵfac});class ti{}ti.ɵfac=function(e){return new(e||ti)},ti.ɵmod=h.oAB({type:ti}),ti.ɵinj=h.cJS({providers:[{provide:Ee.n,useClass:ii}],imports:[Re.d]});var ni=t(99042),oi=t(67775),ri=t(72591),li=t(84598),si=t(27027),ci=t(82083),ai=t(57673),ui=t(72285),di=t(83505),hi=t(33287),pi=t(27643),gi=t(95607),fi=t(59673),mi=t(84879),vi=t(37417),bi=t(95638),Ui=t(4003),Zi=t(16776),_i=t(75230),wi=t(24415),Ai=t(61265),yi=t(19572),xi=t(77140),Ci=t(76528),Ti=t(58172),Si=t(53481),Ii=t(24610),qi=t(2051),zi=function(e,i,t,n){return new(t||(t=Promise))((function(o,r){function l(e){try{c(n.next(e))}catch(i){r(i)}}function s(e){try{c(n.throw(e))}catch(i){r(i)}}function c(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(l,s)}c((n=n.apply(e,i||[])).next())}))};function Mi(e,i){if(1&e&&(h.TgZ(0,"small"),h._uU(1),h.qZA()),2&e){const e=h.oxw();h.xp6(1),h.Oqu(e.cipher.name)}}function Ji(e,i){1&e&&h._UZ(0,"i",24)}function Fi(e,i){1&e&&h._UZ(0,"i",25)}function Oi(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"div",26),h._uU(1,"\n                    "),h.TgZ(2,"a",27),h._uU(3,"\n                      "),h._UZ(4,"i",28),h.ALo(5,"i18n"),h._uU(6,"\n                      "),h.TgZ(7,"span",29),h._uU(8),h.ALo(9,"i18n"),h.qZA()(),h._uU(10,"\n                    "),h.TgZ(11,"button",30,31),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw().$implicit,t=h.oxw(2);return h.KtG(t.reupload(i))})),h._uU(13),h.ALo(14,"i18n"),h.qZA(),h._uU(15,"\n                  "),h.qZA()}if(2&e){const e=h.MAs(12),i=h.oxw().$implicit,t=h.oxw(2);h.xp6(4),h.s9C("title",h.lcZ(5,5,"attachmentFixDesc")),h.xp6(4),h.Oqu(h.lcZ(9,7,"attachmentFixDesc")),h.xp6(3),h.Q6J("appApiAction",t.reuploadPromises[i.id])("disabled",e.loading),h.xp6(2),h.hij("\n                      ",h.lcZ(14,9,"fix"),"\n                    ")}}function Li(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"td",32),h._uU(1,"\n                "),h.TgZ(2,"button",33,34),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw().$implicit,t=h.oxw(2);return h.KtG(t.delete(i))})),h.ALo(4,"i18n"),h._uU(5,"\n                  "),h._UZ(6,"i",35),h._uU(7,"\n                  "),h._UZ(8,"i",36),h.ALo(9,"i18n"),h._uU(10,"\n                "),h.qZA(),h._uU(11,"\n              "),h.qZA()}if(2&e){const e=h.MAs(3),i=h.oxw().$implicit,t=h.oxw(2);h.xp6(2),h.s9C("appA11yTitle",h.lcZ(4,6,"delete")),h.Q6J("appApiAction",t.deletePromises[i.id])("disabled",e.loading),h.xp6(4),h.Q6J("hidden",e.loading),h.xp6(2),h.s9C("title",h.lcZ(9,8,"loading")),h.Q6J("hidden",!e.loading)}}function Yi(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"tr"),h._uU(1,"\n              "),h.TgZ(2,"td",16),h._uU(3,"\n                "),h.YNc(4,Ji,1,0,"i",17),h._uU(5,"\n                "),h.YNc(6,Fi,1,0,"i",18),h._uU(7,"\n              "),h.qZA(),h._uU(8,"\n              "),h.TgZ(9,"td",19),h._uU(10,"\n                "),h.TgZ(11,"div",20),h._uU(12,"\n                  "),h.TgZ(13,"a",21),h.NdJ("click",(function(){const i=h.CHM(e).$implicit,t=h.oxw(2);return h.KtG(t.download(i))})),h._uU(14),h.qZA(),h._uU(15,"\n                  "),h.YNc(16,Oi,16,11,"div",22),h._uU(17,"\n                "),h.qZA(),h._uU(18,"\n                "),h.TgZ(19,"small"),h._uU(20),h.qZA(),h._uU(21,"\n              "),h.qZA(),h._uU(22,"\n              "),h.YNc(23,Li,12,10,"td",23),h._uU(24,"\n            "),h.qZA()}if(2&e){const e=i.$implicit,t=h.oxw(2);h.xp6(4),h.Q6J("ngIf",!e.downloading),h.xp6(2),h.Q6J("ngIf",e.downloading),h.xp6(8),h.Oqu(e.fileName),h.xp6(2),h.Q6J("ngIf",t.showFixOldAttachments(e)),h.xp6(4),h.Oqu(e.sizeName),h.xp6(3),h.Q6J("ngIf",!t.viewOnly)}}function Ni(e,i){if(1&e&&(h.TgZ(0,"table",14),h._uU(1,"\n          "),h.TgZ(2,"tbody"),h._uU(3,"\n            "),h.YNc(4,Yi,25,6,"tr",15),h._uU(5,"\n          "),h.qZA(),h._uU(6,"\n        "),h.qZA()),2&e){const e=h.oxw();h.xp6(4),h.Q6J("ngForOf",e.cipher.attachments)}}function Gi(e,i){1&e&&(h.TgZ(0,"div"),h._uU(1,"\n          "),h.TgZ(2,"h3"),h._uU(3),h.ALo(4,"i18n"),h.qZA(),h._uU(5,"\n          "),h.TgZ(6,"label",37),h._uU(7),h.ALo(8,"i18n"),h.qZA(),h._uU(9,"\n          "),h._UZ(10,"input",38),h._uU(11,"\n          "),h.TgZ(12,"small",39),h._uU(13),h.ALo(14,"i18n"),h.qZA(),h._uU(15,"\n        "),h.qZA()),2&e&&(h.xp6(3),h.Oqu(h.lcZ(4,3,"newAttachment")),h.xp6(4),h.Oqu(h.lcZ(8,5,"file")),h.xp6(6),h.Oqu(h.lcZ(14,7,"maxFileSize")))}function ki(e,i){if(1&e&&(h.TgZ(0,"button",40),h._uU(1,"\n          "),h._UZ(2,"i",41),h.ALo(3,"i18n"),h._uU(4,"\n          "),h.TgZ(5,"span"),h._uU(6),h.ALo(7,"i18n"),h.qZA(),h._uU(8,"\n        "),h.qZA()),2&e){h.oxw();const e=h.MAs(5);h.Q6J("disabled",e.loading),h.xp6(2),h.s9C("title",h.lcZ(3,3,"loading")),h.xp6(4),h.Oqu(h.lcZ(7,5,"save"))}}class Di extends xi.t{constructor(e,i,t,n,o,r,l,s,c){super(e,i,t,n,o,r,l,s,c),this.viewOnly=!1}reupload(e){const i=Object.create(null,{reuploadCipherAttachment:{get:()=>super.reuploadCipherAttachment}});return zi(this,void 0,void 0,(function*(){this.organization.canEditAnyCollection&&this.showFixOldAttachments(e)&&(yield i.reuploadCipherAttachment.call(this,e,!0))}))}loadCipher(){const e=Object.create(null,{loadCipher:{get:()=>super.loadCipher}});return zi(this,void 0,void 0,(function*(){if(!this.organization.canEditAnyCollection)return yield e.loadCipher.call(this);const i=yield this.apiService.getCipherAdmin(this.cipherId);return new yi.t(new Ai.O(i))}))}saveCipherAttachment(e){return this.cipherService.saveAttachmentWithServer(this.cipherDomain,e,this.organization.canEditAnyCollection)}deleteCipherAttachment(e){return this.organization.canEditAnyCollection?this.apiService.deleteCipherAttachmentAdmin(this.cipherId,e):super.deleteCipherAttachment(e)}showFixOldAttachments(e){return null==e.key&&this.organization.canEditAnyCollection}}Di.ɵfac=function(e){return new(e||Di)(h.Y36(Ve.u),h.Y36(N.D),h.Y36(Ci.$),h.Y36(Ti.b),h.Y36(k.P),h.Y36(L.s),h.Y36(D.$),h.Y36(Si._),h.Y36(x.eo))},Di.ɵcmp=h.Xpm({type:Di,selectors:[["app-org-vault-attachments"]],features:[h.qOj],decls:42,vars:14,consts:[["role","dialog","aria-modal","true","aria-labelledby","attachmentsTitle",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-scrollable"],["ngNativeValidate","",1,"modal-content",3,"appApiAction","ngSubmit"],["form",""],[1,"modal-header"],["id","attachmentsTitle",1,"modal-title"],[4,"ngIf"],["type","button","data-dismiss","modal",1,"close",3,"appA11yTitle"],["aria-hidden","true"],[1,"modal-body"],["class","table table-hover table-list",4,"ngIf"],[1,"modal-footer"],["type","submit","class","btn btn-primary btn-submit",3,"disabled",4,"ngIf"],["type","button","data-dismiss","modal",1,"btn","btn-outline-secondary"],[1,"table","table-hover","table-list"],[4,"ngFor","ngForOf"],[1,"table-list-icon"],["class","bwi bwi-fw bwi-lg bwi-file","aria-hidden","true",4,"ngIf"],["class","bwi bwi-spinner bwi-lg bwi-fw bwi-spin","aria-hidden","true",4,"ngIf"],[1,"wrap"],[1,"d-flex"],["href","#","appStopClick","",3,"click"],["class","ml-2",4,"ngIf"],["class","table-list-options",4,"ngIf"],["aria-hidden","true",1,"bwi","bwi-fw","bwi-lg","bwi-file"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-lg","bwi-fw","bwi-spin"],[1,"ml-2"],["href","https://bitwarden.com/help/attachments/#fixing-old-attachments","target","_blank","rel","noopener"],["aria-hidden","true",1,"bwi","bwi-exclamation-triangle","text-warning",3,"title"],[1,"sr-only"],["type","button",1,"btn","btn-outline-primary","btn-sm","m-0","py-0","px-2",3,"appApiAction","disabled","click"],["reuploadBtn",""],[1,"table-list-options"],["type","button","appStopClick","",1,"btn","btn-outline-danger",3,"appA11yTitle","appApiAction","disabled","click"],["deleteBtn",""],["aria-hidden","true",1,"bwi","bwi-trash","bwi-lg","bwi-fw",3,"hidden"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","bwi-lg","bwi-fw",3,"hidden","title"],["for","file",1,"sr-only"],["type","file","id","file","name","file","required","",1,"form-control-file"],[1,"form-text","text-muted"],["type","submit",1,"btn","btn-primary","btn-submit",3,"disabled"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin",3,"title"]],template:function(e,i){1&e&&(h.TgZ(0,"div",0),h._uU(1,"\n  "),h.TgZ(2,"div",1),h._uU(3,"\n    "),h.TgZ(4,"form",2,3),h.NdJ("ngSubmit",(function(){return i.submit()})),h._uU(6,"\n      "),h.TgZ(7,"div",4),h._uU(8,"\n        "),h.TgZ(9,"h1",5),h._uU(10),h.ALo(11,"i18n"),h.YNc(12,Mi,2,1,"small",6),h._uU(13,"\n        "),h.qZA(),h._uU(14,"\n        "),h.TgZ(15,"button",7),h.ALo(16,"i18n"),h._uU(17,"\n          "),h.TgZ(18,"span",8),h._uU(19,"×"),h.qZA(),h._uU(20,"\n        "),h.qZA(),h._uU(21,"\n      "),h.qZA(),h._uU(22,"\n      "),h.TgZ(23,"div",9),h._uU(24,"\n        "),h.YNc(25,Ni,7,1,"table",10),h._uU(26,"\n        "),h.YNc(27,Gi,16,9,"div",6),h._uU(28,"\n      "),h.qZA(),h._uU(29,"\n      "),h.TgZ(30,"div",11),h._uU(31,"\n        "),h.YNc(32,ki,9,7,"button",12),h._uU(33,"\n        "),h.TgZ(34,"button",13),h._uU(35),h.ALo(36,"i18n"),h.qZA(),h._uU(37,"\n      "),h.qZA(),h._uU(38,"\n    "),h.qZA(),h._uU(39,"\n  "),h.qZA(),h._uU(40,"\n"),h.qZA(),h._uU(41,"\n")),2&e&&(h.xp6(4),h.Q6J("appApiAction",i.formPromise),h.xp6(6),h.hij("\n          ",h.lcZ(11,8,"attachments"),"\n          "),h.xp6(2),h.Q6J("ngIf",i.cipher),h.xp6(3),h.s9C("appA11yTitle",h.lcZ(16,10,"close")),h.xp6(10),h.Q6J("ngIf",i.cipher&&i.cipher.hasAttachments),h.xp6(2),h.Q6J("ngIf",!i.viewOnly),h.xp6(5),h.Q6J("ngIf",!i.viewOnly),h.xp6(3),h.hij("\n          ",h.lcZ(36,12,"close"),"\n        "))},dependencies:[$.sg,$.O5,z.JL,z.F,Q.B,Ii.b,qi.O,re.C],encapsulation:2});var $i=t(43898),Qi=t(17475),Pi=t(12963),Ei=function(e,i,t,n){return new(t||(t=Promise))((function(o,r){function l(e){try{c(n.next(e))}catch(i){r(i)}}function s(e){try{c(n.throw(e))}catch(i){r(i)}}function c(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(l,s)}c((n=n.apply(e,i||[])).next())}))};function Ri(e,i){if(1&e&&(h.TgZ(0,"small"),h._uU(1),h.qZA()),2&e){const e=h.oxw();h.xp6(1),h.Oqu(e.cipher.name)}}function Bi(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"div",17),h._uU(1,"\n            "),h.TgZ(2,"button",18),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw();return h.KtG(i.selectAll(!0))})),h._uU(3),h.ALo(4,"i18n"),h.qZA(),h._uU(5,"\n            "),h.TgZ(6,"button",18),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw();return h.KtG(i.selectAll(!1))})),h._uU(7),h.ALo(8,"i18n"),h.qZA(),h._uU(9,"\n          "),h.qZA()}2&e&&(h.xp6(3),h.hij("\n              ",h.lcZ(4,2,"selectAll"),"\n            "),h.xp6(4),h.hij("\n              ",h.lcZ(8,4,"unselectAll"),"\n            "))}function ji(e,i){1&e&&(h.TgZ(0,"div"),h._uU(1),h.ALo(2,"i18n"),h.qZA()),2&e&&(h.xp6(1),h.hij("\n          ",h.lcZ(2,1,"noCollectionsInList"),"\n        "))}function Hi(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"tr",21),h.NdJ("click",(function(){const i=h.CHM(e).$implicit,t=h.oxw(2);return h.KtG(t.check(i))})),h._uU(1,"\n              "),h.TgZ(2,"td",22),h._uU(3,"\n                "),h.TgZ(4,"input",23),h.NdJ("ngModelChange",(function(i){const t=h.CHM(e).$implicit;return h.KtG(t.checked=i)})),h.qZA(),h._uU(5,"\n              "),h.qZA(),h._uU(6,"\n              "),h.TgZ(7,"td"),h._uU(8),h.qZA(),h._uU(9,"\n            "),h.qZA()}if(2&e){const e=i.$implicit,t=i.index;h.xp6(4),h.MGl("name","Collection[",t,"].Checked"),h.Q6J("ngModel",e.checked),h.xp6(4),h.hij("\n                ",e.name,"\n              ")}}function Ki(e,i){if(1&e&&(h.TgZ(0,"table",19),h._uU(1,"\n          "),h.TgZ(2,"tbody"),h._uU(3,"\n            "),h.YNc(4,Hi,10,3,"tr",20),h._uU(5,"\n          "),h.qZA(),h._uU(6,"\n        "),h.qZA()),2&e){const e=h.oxw();h.xp6(4),h.Q6J("ngForOf",e.collections)}}class Wi extends Qi.U{constructor(e,i,t,n,o,r){super(e,i,t,n,r),this.apiService=o,this.allowSelectNone=!0}loadCipher(){const e=Object.create(null,{loadCipher:{get:()=>super.loadCipher}});return Ei(this,void 0,void 0,(function*(){if(!this.organization.canViewAllCollections)return yield e.loadCipher.call(this);const i=yield this.apiService.getCipherAdmin(this.cipherId);return new yi.t(new Ai.O(i))}))}loadCipherCollections(){return this.organization.canViewAllCollections?this.collectionIds:super.loadCipherCollections()}loadCollections(){return this.organization.canViewAllCollections?Promise.resolve(this.collections):super.loadCollections()}saveCollections(){if(this.organization.canEditAnyCollection){const e=new $i.L(this.cipherDomain.collectionIds);return this.apiService.putCipherCollectionsAdmin(this.cipherId,e)}return super.saveCollections()}}Wi.ɵfac=function(e){return new(e||Wi)(h.Y36(G.a),h.Y36(k.P),h.Y36(N.D),h.Y36(Ve.u),h.Y36(L.s),h.Y36(D.$))},Wi.ɵcmp=h.Xpm({type:Wi,selectors:[["app-org-vault-collections"]],features:[h.qOj],decls:63,vars:27,consts:[["role","dialog","aria-modal","true","aria-labelledby","collectionsTitle",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-scrollable"],[1,"modal-content",3,"appApiAction","ngSubmit"],["form",""],[1,"modal-header"],["id","collectionsTitle",1,"modal-title"],[4,"ngIf"],["type","button","data-dismiss","modal",1,"close",3,"appA11yTitle"],["aria-hidden","true"],[1,"modal-body"],[1,"d-flex"],["class","ml-auto d-flex",4,"ngIf"],["class","table table-hover table-list mb-0",4,"ngIf"],[1,"modal-footer"],["type","submit",1,"btn","btn-primary","btn-submit",3,"disabled"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin",3,"title"],["type","button","data-dismiss","modal",1,"btn","btn-outline-secondary"],[1,"ml-auto","d-flex"],["type","button",1,"btn","btn-link","btn-sm","py-0",3,"click"],[1,"table","table-hover","table-list","mb-0"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[1,"table-list-checkbox"],["type","checkbox","appStopProp","",3,"ngModel","name","ngModelChange"]],template:function(e,i){if(1&e&&(h.TgZ(0,"div",0),h._uU(1,"\n  "),h.TgZ(2,"div",1),h._uU(3,"\n    "),h.TgZ(4,"form",2,3),h.NdJ("ngSubmit",(function(){return i.submit()})),h._uU(6,"\n      "),h.TgZ(7,"div",4),h._uU(8,"\n        "),h.TgZ(9,"h1",5),h._uU(10),h.ALo(11,"i18n"),h.YNc(12,Ri,2,1,"small",6),h._uU(13,"\n        "),h.qZA(),h._uU(14,"\n        "),h.TgZ(15,"button",7),h.ALo(16,"i18n"),h._uU(17,"\n          "),h.TgZ(18,"span",8),h._uU(19,"×"),h.qZA(),h._uU(20,"\n        "),h.qZA(),h._uU(21,"\n      "),h.qZA(),h._uU(22,"\n      "),h.TgZ(23,"div",9),h._uU(24,"\n        "),h.TgZ(25,"p"),h._uU(26),h.ALo(27,"i18n"),h.qZA(),h._uU(28,"\n        "),h.TgZ(29,"div",10),h._uU(30,"\n          "),h.TgZ(31,"h3"),h._uU(32),h.ALo(33,"i18n"),h.qZA(),h._uU(34,"\n          "),h.YNc(35,Bi,10,6,"div",11),h._uU(36,"\n        "),h.qZA(),h._uU(37,"\n        "),h.YNc(38,ji,3,3,"div",6),h._uU(39,"\n        "),h.YNc(40,Ki,7,1,"table",12),h._uU(41,"\n      "),h.qZA(),h._uU(42,"\n      "),h.TgZ(43,"div",13),h._uU(44,"\n        "),h.TgZ(45,"button",14),h._uU(46,"\n          "),h._UZ(47,"i",15),h.ALo(48,"i18n"),h._uU(49,"\n          "),h.TgZ(50,"span"),h._uU(51),h.ALo(52,"i18n"),h.qZA(),h._uU(53,"\n        "),h.qZA(),h._uU(54,"\n        "),h.TgZ(55,"button",16),h._uU(56),h.ALo(57,"i18n"),h.qZA(),h._uU(58,"\n      "),h.qZA(),h._uU(59,"\n    "),h.qZA(),h._uU(60,"\n  "),h.qZA(),h._uU(61,"\n"),h.qZA(),h._uU(62,"\n")),2&e){const e=h.MAs(5);h.xp6(4),h.Q6J("appApiAction",i.formPromise),h.xp6(6),h.hij("\n          ",h.lcZ(11,13,"collections"),"\n          "),h.xp6(2),h.Q6J("ngIf",i.cipher),h.xp6(3),h.s9C("appA11yTitle",h.lcZ(16,15,"close")),h.xp6(11),h.Oqu(h.lcZ(27,17,"collectionsDesc")),h.xp6(6),h.Oqu(h.lcZ(33,19,"collections")),h.xp6(3),h.Q6J("ngIf",i.collections&&i.collections.length),h.xp6(3),h.Q6J("ngIf",!i.collections||!i.collections.length),h.xp6(2),h.Q6J("ngIf",i.collections&&i.collections.length),h.xp6(5),h.Q6J("disabled",e.loading),h.xp6(2),h.s9C("title",h.lcZ(48,21,"loading")),h.xp6(4),h.Oqu(h.lcZ(52,23,"save")),h.xp6(5),h.hij("\n          ",h.lcZ(57,25,"cancel"),"\n        ")}},dependencies:[$.sg,$.O5,z._Y,z.Wl,z.JJ,z.JL,z.On,z.F,Q.B,Ii.b,Pi._,re.C],encapsulation:2});t(27263);var Vi=t(2739),Xi=t(26187),et=function(e,i,t,n){return new(t||(t=Promise))((function(o,r){function l(e){try{c(n.next(e))}catch(i){r(i)}}function s(e){try{c(n.throw(e))}catch(i){r(i)}}function c(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(l,s)}c((n=n.apply(e,i||[])).next())}))};function it(e,i){1&e&&(h.TgZ(0,"div",3),h._uU(1,"\n    "),h._UZ(2,"i",4),h._uU(3,"\n  "),h.qZA())}function tt(e,i){if(1&e&&(h.ynx(0),h._uU(1,"\n        "),h.TgZ(2,"div",11),h._uU(3,"\n          "),h.TgZ(4,"app-filter-section",12),h._uU(5," "),h.qZA(),h._uU(6,"\n        "),h.qZA(),h._uU(7,"\n      "),h.BQk()),2&e){const e=i.$implicit,t=h.oxw(2);h.xp6(4),h.Q6J("activeFilter",t.activeFilter)("section",e)}}function nt(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"div"),h._uU(1,"\n    "),h.TgZ(2,"div",5),h._uU(3),h.ALo(4,"i18n"),h.TgZ(5,"a",6),h.ALo(6,"i18n"),h._uU(7,"\n        "),h._UZ(8,"i",7),h._uU(9,"\n      "),h.qZA(),h._uU(10,"\n    "),h.qZA(),h._uU(11,"\n    "),h.TgZ(12,"div",8),h._uU(13,"\n      "),h.TgZ(14,"input",9),h.NdJ("ngModelChange",(function(i){h.CHM(e);const t=h.oxw();return h.KtG(t.onSearchTextChanged(i))})),h.ALo(15,"i18n"),h.qZA(),h._uU(16,"\n      "),h.YNc(17,tt,8,2,"ng-container",10),h._uU(18,"\n    "),h.qZA(),h._uU(19,"\n  "),h.qZA()}if(2&e){const e=h.oxw();h.xp6(3),h.hij("\n      ",h.lcZ(4,5,"filters"),"\n      "),h.xp6(2),h.s9C("appA11yTitle",h.lcZ(6,7,"learnMore")),h.xp6(9),h.s9C("placeholder",h.lcZ(15,9,e.searchPlaceholder)),h.Q6J("ngModel",e.searchText),h.xp6(3),h.Q6J("ngForOf",e.filtersList)}}class ot extends Vi.P{set organization(e){e&&e!==this._organization&&(this._organization=e,this.vaultFilterService.setOrganizationFilter(this._organization))}ngOnInit(){return et(this,void 0,void 0,(function*(){this.filters=yield this.buildAllFilters(),this.activeFilter.selectedCipherTypeNode||(this.activeFilter.resetFilter(),this.activeFilter.selectedCollectionNode=yield this.getDefaultFilter()),this.isLoaded=!0}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}buildAllFilters(){return et(this,void 0,void 0,(function*(){const e={};return e.typeFilter=yield this.addTypeFilter(["favorites"]),e.collectionFilter=yield this.addCollectionFilter(),e.trashFilter=yield this.addTrashFilter(),e}))}getDefaultFilter(){var e;return et(this,void 0,void 0,(function*(){return yield(0,ni.z)(null===(e=this.filters)||void 0===e?void 0:e.collectionFilter.data$)}))}}ot.ɵfac=function(){let e;return function(i){return(e||(e=h.n5z(ot)))(i||ot)}}(),ot.ɵcmp=h.Xpm({type:ot,selectors:[["app-organization-vault-filter"]],inputs:{organization:"organization"},features:[h.qOj],decls:7,vars:2,consts:[[1,"card","vault-filters"],["class","container loading-spinner",4,"ngIf"],[4,"ngIf"],[1,"container","loading-spinner"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","bwi-3x"],[1,"card-header","d-flex"],["href","https://bitwarden.com/help/searching-vault/","target","_blank","rel","noopener",1,"ml-auto",3,"appA11yTitle"],["aria-hidden","true",1,"bwi","bwi-question-circle"],[1,"card-body"],["type","search","id","search","autocomplete","off","appAutofocus","",1,"form-control",3,"placeholder","ngModel","ngModelChange"],[4,"ngFor","ngForOf"],[1,"filter"],[3,"activeFilter","section"]],template:function(e,i){1&e&&(h.TgZ(0,"div",0),h._uU(1,"\n  "),h.YNc(2,it,4,0,"div",1),h._uU(3,"\n  "),h.YNc(4,nt,20,11,"div",2),h._uU(5,"\n"),h.qZA(),h._uU(6,"\n")),2&e&&(h.xp6(2),h.Q6J("ngIf",!i.isLoaded),h.xp6(2),h.Q6J("ngIf",i.isLoaded))},dependencies:[$.sg,$.O5,z.Fj,z.JJ,z.On,Q.B,P.U,Xi.n,re.C],encapsulation:2});var rt=t(4871),lt=t(34961),st=t(7323),ct=t(95169),at=t(87483),ut=t(27191),dt=t(53707),ht=t(22221),pt=t(98583),gt=t(8427),ft=t(93814),mt=function(e,i,t,n){return new(t||(t=Promise))((function(o,r){function l(e){try{c(n.next(e))}catch(i){r(i)}}function s(e){try{c(n.throw(e))}catch(i){r(i)}}function c(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(l,s)}c((n=n.apply(e,i||[])).next())}))};const vt=function(){return[]},bt=function(e){return{collectionId:e}};function Ut(e,i){if(1&e&&(h.TgZ(0,"bit-breadcrumb",7),h._uU(1),h.qZA()),2&e){const e=i.$implicit;h.Q6J("route",h.DdM(3,vt))("queryParams",h.VKq(4,bt,e.id)),h.xp6(1),h.hij("\n          ",e.name,"\n        ")}}const Zt=function(e){return{organizationId:e,collectionId:null}};function _t(e,i){if(1&e&&(h.TgZ(0,"bit-breadcrumbs"),h._uU(1,"\n      "),h.TgZ(2,"bit-breadcrumb",5),h._uU(3),h.ALo(4,"lowercase"),h.ALo(5,"i18n"),h.qZA(),h._uU(6,"\n      "),h.ynx(7),h._uU(8,"\n        "),h.YNc(9,Ut,2,6,"bit-breadcrumb",6),h._uU(10,"\n      "),h.BQk(),h._uU(11,"\n    "),h.qZA()),2&e){const e=h.oxw();h.xp6(2),h.Q6J("route",h.DdM(9,vt))("queryParams",h.VKq(10,Zt,e.organization.id)),h.xp6(1),h.AsE("\n        ",e.organization.name," ",h.lcZ(4,5,h.lcZ(5,7,"vault")),"\n      "),h.xp6(6),h.Q6J("ngForOf",e.collections)}}function wt(e,i){1&e&&h._UZ(0,"i",8)}function At(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"button",12),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.editCollection(i.CollectionDialogTabType.Info))})),h._uU(1,"\n            "),h._UZ(2,"i",13),h._uU(3),h.ALo(4,"i18n"),h.qZA()}2&e&&(h.xp6(3),h.hij("\n            ",h.lcZ(4,1,"editInfo"),"\n          "))}function yt(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"button",12),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.editCollection(i.CollectionDialogTabType.Access))})),h._uU(1,"\n            "),h._UZ(2,"i",14),h._uU(3),h.ALo(4,"i18n"),h.qZA()}2&e&&(h.xp6(3),h.hij("\n            ",h.lcZ(4,1,"access"),"\n          "))}function xt(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"button",12),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.deleteCollection())})),h._uU(1,"\n            "),h.TgZ(2,"span",15),h._uU(3,"\n              "),h._UZ(4,"i",16),h._uU(5),h.ALo(6,"i18n"),h.qZA(),h._uU(7,"\n          "),h.qZA()}2&e&&(h.xp6(5),h.hij("\n              ",h.lcZ(6,1,"delete"),"\n            "))}function Ct(e,i){if(1&e&&(h.ynx(0),h._uU(1,"\n        "),h._UZ(2,"button",9),h._uU(3,"\n        "),h.TgZ(4,"bit-menu",null,10),h._uU(6,"\n          "),h.YNc(7,At,5,3,"button",11),h._uU(8,"\n          "),h.YNc(9,yt,5,3,"button",11),h._uU(10,"\n          "),h.YNc(11,xt,8,3,"button",11),h._uU(12,"\n        "),h.qZA(),h._uU(13,"\n      "),h.BQk()),2&e){const e=h.MAs(5),i=h.oxw();h.xp6(2),h.Q6J("bitMenuTriggerFor",e),h.xp6(5),h.Q6J("ngIf",i.canEditCollection),h.xp6(2),h.Q6J("ngIf",i.canEditCollection),h.xp6(2),h.Q6J("ngIf",i.canDeleteCollection)}}function Tt(e,i){1&e&&(h.TgZ(0,"small"),h._uU(1,"\n        "),h._UZ(2,"i",17),h.ALo(3,"i18n"),h._uU(4,"\n        "),h.TgZ(5,"span",18),h._uU(6),h.ALo(7,"i18n"),h.qZA(),h._uU(8,"\n      "),h.qZA()),2&e&&(h.xp6(2),h.s9C("title",h.lcZ(3,2,"loading")),h.xp6(4),h.Oqu(h.lcZ(7,4,"loading")))}function St(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"div",22),h._uU(1,"\n      "),h.TgZ(2,"button",23),h.ALo(3,"i18n"),h._uU(4),h.ALo(5,"i18n"),h._UZ(6,"i",24),h._uU(7,"\n      "),h.qZA(),h._uU(8,"\n      "),h.TgZ(9,"bit-menu",25,26),h._uU(11,"\n        "),h.TgZ(12,"button",12),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.addCipher())})),h._uU(13,"\n          "),h._UZ(14,"i",27),h._uU(15),h.ALo(16,"i18n"),h.qZA(),h._uU(17,"\n        "),h.TgZ(18,"button",12),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.addCollection())})),h._uU(19,"\n          "),h._UZ(20,"i",28),h._uU(21),h.ALo(22,"i18n"),h.qZA(),h._uU(23,"\n      "),h.qZA(),h._uU(24,"\n    "),h.qZA()}if(2&e){const e=h.MAs(10);h.xp6(2),h.s9C("appA11yTitle",h.lcZ(3,5,"new")),h.Q6J("bitMenuTriggerFor",e),h.xp6(2),h.hij("\n        ",h.lcZ(5,7,"new"),""),h.xp6(11),h.hij("\n          ",h.lcZ(16,9,"item"),"\n        "),h.xp6(6),h.hij("\n          ",h.lcZ(22,11,"collection"),"\n        ")}}function It(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"button",29),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.addCipher())})),h._uU(1,"\n      "),h._UZ(2,"i",30),h._uU(3),h.ALo(4,"i18n"),h.qZA()}2&e&&(h.xp6(3),h.hij("\n      ",h.lcZ(4,1,"newItem"),"\n    "))}function qt(e,i){if(1&e&&(h.TgZ(0,"div",19),h._uU(1,"\n    "),h.YNc(2,St,25,13,"div",20),h._uU(3,"\n    "),h.YNc(4,It,5,3,"button",21),h._uU(5,"\n  "),h.qZA()),2&e){const e=h.oxw();h.xp6(2),h.Q6J("ngIf",e.organization.canCreateNewCollections),h.xp6(2),h.Q6J("ngIf",!e.organization.canCreateNewCollections)}}class zt{constructor(e,i,t,n,o){this.organizationService=e,this.i18nService=i,this.dialogService=t,this.collectionAdminService=n,this.router=o,this.All=Zi.oT,this.Unassigned=Zi.JK,this.onAddCipher=new h.vpe,this.onAddCollection=new h.vpe,this.onEditCollection=new h.vpe,this.onDeleteCollection=new h.vpe,this.CollectionDialogTabType=De.sn,this.organizations$=this.organizationService.organizations$}get title(){return void 0!==this.collection?this.collection.node.name:this.filter.collectionId===Zi.JK?this.i18nService.t("unassigned"):`${this.organization.name} ${this.i18nService.t("vault").toLowerCase()}`}get showBreadcrumbs(){return void 0!==this.filter.collectionId&&this.filter.collectionId!==Zi.oT}get collections(){if(null==this.collection)return[];const e=[this.collection];for(;null!=e[e.length-1].parent;)e.push(e[e.length-1].parent);return e.slice(1).reverse().map((e=>e.node))}showFreeOrgUpgradeDialog(){const e={title:this.i18nService.t("upgradeOrganization"),content:this.i18nService.t(this.organization.canEditSubscription?"freeOrgMaxCollectionReachedManageBilling":"freeOrgMaxCollectionReachedNoManageBilling",this.organization.maxCollections),type:x.rC.PRIMARY};this.organization.canEditSubscription?e.acceptButtonText=this.i18nService.t("upgrade"):(e.acceptButtonText=this.i18nService.t("ok"),e.cancelButtonText=null);const i=this.dialogService.openSimpleDialogRef(e);(0,ni.z)(i.closed).then((e=>{e&&e==x.mr.ACCEPT&&this.organization.canEditSubscription&&this.router.navigate(["/organizations",this.organization.id,"billing","subscription"],{queryParams:{upgrade:!0}})}))}get canEditCollection(){var e;return void 0!==this.collection&&(this.organization.canEditAnyCollection||this.organization.canEditAssignedCollections&&(null===(e=this.collection)||void 0===e?void 0:e.node.assigned))}addCipher(){this.onAddCipher.emit()}addCollection(){return mt(this,void 0,void 0,(function*(){if(this.organization.planProductType===ci.kv.Free){if((yield this.collectionAdminService.getAll(this.organization.id)).length===this.organization.maxCollections)return void this.showFreeOrgUpgradeDialog()}this.onAddCollection.emit()}))}editCollection(e){return mt(this,void 0,void 0,(function*(){this.onEditCollection.emit({tab:e})}))}get canDeleteCollection(){var e,i;return void 0!==this.collection&&((null===(e=this.organization)||void 0===e?void 0:e.canDeleteAnyCollection)||(null===(i=this.organization)||void 0===i?void 0:i.canDeleteAssignedCollections)&&this.collection.node.assigned)}deleteCollection(){this.onDeleteCollection.emit()}}zt.ɵfac=function(e){return new(e||zt)(h.Y36(c.Mn),h.Y36(N.D),h.Y36(x.eo),h.Y36(He.m),h.Y36(l.F0))},zt.ɵcmp=h.Xpm({type:zt,selectors:[["app-org-vault-header"]],inputs:{loading:"loading",filter:"filter",organization:"organization",collection:"collection"},outputs:{onAddCipher:"onAddCipher",onAddCollection:"onAddCollection",onEditCollection:"onEditCollection",onDeleteCollection:"onDeleteCollection"},decls:22,vars:6,consts:[[1,"tw-mb-4","tw-flex","tw-items-start","tw-justify-between"],[4,"ngIf"],[1,"tw-mb-0","tw-mt-1","tw-flex","tw-items-center","tw-space-x-2"],["class","bwi bwi-collection","aria-hidden","true",4,"ngIf"],["class","tw-shrink-0",4,"ngIf"],["queryParamsHandling","merge",3,"route","queryParams"],["icon","bwi-collection","queryParamsHandling","merge",3,"route","queryParams",4,"ngFor","ngForOf"],["icon","bwi-collection","queryParamsHandling","merge",3,"route","queryParams"],["aria-hidden","true",1,"bwi","bwi-collection"],["bitIconButton","bwi-angle-down","size","small","type","button","aria-haspopup","",3,"bitMenuTriggerFor"],["editCollectionMenu",""],["type","button","bitMenuItem","",3,"click",4,"ngIf"],["type","button","bitMenuItem","",3,"click"],["aria-hidden","true",1,"bwi","bwi-fw","bwi-pencil-square"],["aria-hidden","true",1,"bwi","bwi-fw","bwi-users"],[1,"tw-text-danger"],["aria-hidden","true",1,"bwi","bwi-fw","bwi-trash"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","text-muted",3,"title"],[1,"tw-sr-only"],[1,"tw-shrink-0"],["appListDropdown","",4,"ngIf"],["type","button","bitButton","","buttonType","primary",3,"click",4,"ngIf"],["appListDropdown",""],["bitButton","","buttonType","primary","type","button","id","newItemDropdown",3,"bitMenuTriggerFor","appA11yTitle"],["aria-hidden","true",1,"bwi","bwi-angle-down","tw-ml-2"],["aria-labelledby","newItemDropdown"],["addOptions",""],["aria-hidden","true",1,"bwi","bwi-fw","bwi-globe"],["aria-hidden","true",1,"bwi","bwi-fw","bwi-collection"],["type","button","bitButton","","buttonType","primary",3,"click"],["aria-hidden","true",1,"bwi","bwi-plus","bwi-fw"]],template:function(e,i){1&e&&(h.TgZ(0,"div",0),h._uU(1,"\n  "),h.TgZ(2,"div"),h._uU(3,"\n    "),h.YNc(4,_t,12,12,"bit-breadcrumbs",1),h._uU(5,"\n    "),h.TgZ(6,"h1",2),h._uU(7,"\n      "),h.YNc(8,wt,1,0,"i",3),h._uU(9,"\n      "),h.TgZ(10,"span"),h._uU(11),h.qZA(),h._uU(12,"\n      "),h.YNc(13,Ct,14,4,"ng-container",1),h._uU(14,"\n      "),h.YNc(15,Tt,9,6,"small",1),h._uU(16,"\n    "),h.qZA(),h._uU(17,"\n  "),h.qZA(),h._uU(18,"\n\n  "),h.YNc(19,qt,6,2,"div",4),h._uU(20,"\n"),h.qZA(),h._uU(21,"\n")),2&e&&(h.xp6(4),h.Q6J("ngIf",i.showBreadcrumbs),h.xp6(4),h.Q6J("ngIf",void 0!==i.filter.collectionId),h.xp6(3),h.Oqu(i.title),h.xp6(2),h.Q6J("ngIf",void 0!==i.collection&&(i.canEditCollection||i.canDeleteCollection)),h.xp6(2),h.Q6J("ngIf",i.loading),h.xp6(4),h.Q6J("ngIf","trash"!==i.filter.type&&i.filter.collectionId!==i.Unassigned))},dependencies:[$.sg,$.O5,Q.B,j.r,ie.Q,ve.M,be.t,Ue.e,gt.n,ft.L,$.i8,re.C],encapsulation:2});var Mt=function(e,i,t,n){return new(t||(t=Promise))((function(o,r){function l(e){try{c(n.next(e))}catch(i){r(i)}}function s(e){try{c(n.throw(e))}catch(i){r(i)}}function c(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(l,s)}c((n=n.apply(e,i||[])).next())}))};const Jt=["vaultFilter"],Ft=["attachments"],Ot=["cipherAddEdit"],Lt=["collectionsModal"];function Yt(e,i){if(1&e&&(h.TgZ(0,"app-callout",16),h._uU(1),h.qZA()),2&e){const e=h.oxw();h.xp6(1),h.hij("\n        ",e.trashCleanupWarning,"\n      ")}}function Nt(e,i){if(1&e&&(h.TgZ(0,"div",17),h._uU(1,"\n        "),h._UZ(2,"bit-icon",18),h._uU(3,"\n        "),h.TgZ(4,"p"),h._uU(5),h.ALo(6,"i18n"),h.qZA(),h._uU(7,"\n      "),h.qZA()),2&e){const e=h.oxw();h.xp6(2),h.Q6J("icon",e.noItemIcon),h.xp6(3),h.Oqu(h.lcZ(6,2,"noPermissionToViewAllCollectionItems"))}}function Gt(e,i){if(1&e){const e=h.EpF();h.TgZ(0,"button",20),h.NdJ("click",(function(){h.CHM(e);const i=h.oxw(2);return h.KtG(i.addCipher())})),h._uU(1,"\n          "),h._UZ(2,"i",21),h._uU(3),h.ALo(4,"i18n"),h.qZA()}2&e&&(h.xp6(3),h.hij("\n          ",h.lcZ(4,1,"newItem"),"\n        "))}function kt(e,i){if(1&e&&(h.TgZ(0,"div",17),h._uU(1,"\n        "),h._UZ(2,"bit-icon",18),h._uU(3,"\n        "),h.TgZ(4,"p"),h._uU(5),h.ALo(6,"i18n"),h.qZA(),h._uU(7,"\n        "),h.YNc(8,Gt,5,3,"button",19),h._uU(9,"\n      "),h.qZA()),2&e){const e=h.oxw();h.xp6(2),h.Q6J("icon",e.noItemIcon),h.xp6(3),h.Oqu(h.lcZ(6,3,"noItemsInList")),h.xp6(3),h.Q6J("ngIf","trash"!==e.filter.type&&e.filter.collectionId!==e.Unassigned)}}function Dt(e,i){1&e&&(h.TgZ(0,"div",17),h._uU(1,"\n        "),h._UZ(2,"i",22),h.ALo(3,"i18n"),h._uU(4,"\n        "),h.TgZ(5,"span",23),h._uU(6),h.ALo(7,"i18n"),h.qZA(),h._uU(8,"\n      "),h.qZA()),2&e&&(h.xp6(2),h.s9C("title",h.lcZ(3,2,"loading")),h.xp6(4),h.Oqu(h.lcZ(7,4,"loading")))}function $t(e,i){}function Qt(e,i){}function Pt(e,i){}const Et=function(e){return[e]},Rt=function(){return[]},Bt="OrgVaultComponent";class jt{constructor(e,i,t,n,o,r,l,s,c,a,u,d,h,f,m,v,b,U,Z,_,w,A,y,x,C){this.route=e,this.organizationService=i,this.vaultFilterService=t,this.routedVaultFilterBridgeService=n,this.routedVaultFilterService=o,this.router=r,this.changeDetectorRef=l,this.syncService=s,this.i18nService=c,this.modalService=a,this.dialogService=u,this.messagingService=d,this.broadcasterService=h,this.ngZone=f,this.platformUtilsService=m,this.cipherService=v,this.passwordRepromptService=b,this.collectionAdminService=U,this.searchService=Z,this.searchPipe=_,this.groupService=w,this.logService=A,this.eventCollectionService=y,this.totpService=x,this.apiService=C,this.Unassigned=Zi.JK,this.trashCleanupWarning=null,this.activeFilter=new pi.l,this.noItemIcon=di.o,this.performingInitialLoad=!0,this.refreshing=!1,this.processingEvent=!1,this.filter={},this.searchText$=new p.x,this.refresh$=new g.X(null),this.destroy$=new p.x}ngOnInit(){return Mt(this,void 0,void 0,(function*(){this.trashCleanupWarning=this.i18nService.t(this.platformUtilsService.isSelfHost()?"trashCleanupWarningSelfHosted":"trashCleanupWarning");const e=this.routedVaultFilterService.filter$,i=e.pipe((0,Z.U)((e=>e.organizationId)),(0,oi.h)((e=>void 0!==e)),(0,ri.x)()),t=i.pipe((0,m.w)((e=>this.organizationService.get$(e))),(0,_.R)(this.destroy$),(0,li.d)({refCount:!1,bufferSize:1})),n=(0,v.a)([t,this.route.queryParams]).pipe((0,A.P)(),(0,m.w)((([e])=>Mt(this,void 0,void 0,(function*(){this.organization=e,e.canUseAdminCollections||(yield this.syncService.fullSync(!1))})))),(0,li.d)({refCount:!0,bufferSize:1}));this.broadcasterService.subscribe(Bt,(e=>{this.ngZone.run((()=>Mt(this,void 0,void 0,(function*(){if("syncCompleted"===e.command)e.successfully&&(this.refresh(),this.changeDetectorRef.detectChanges())}))))})),this.routedVaultFilterBridgeService.activeFilter$.pipe((0,_.R)(this.destroy$)).subscribe((e=>{this.activeFilter=e})),this.searchText$.pipe((0,si.b)(200),(0,_.R)(this.destroy$)).subscribe((e=>this.router.navigate([],{queryParams:{search:T.c.isNullOrEmpty(e)?null:e},queryParamsHandling:"merge",replaceUrl:!0}))),this.currentSearchText$=this.route.queryParams.pipe((0,Z.U)((e=>e.search)));const o=i.pipe((0,m.w)((e=>this.collectionAdminService.getAll(e))),(0,li.d)({refCount:!0,bufferSize:1})),r=(0,v.a)([i,o]).pipe((0,Z.U)((([e,i])=>{const t=new gi.e;return t.name=this.i18nService.t("unassigned"),t.id=Zi.JK,t.organizationId=e,i.concat(t)}))),l=i.pipe((0,m.w)((e=>this.groupService.getAll(e))),(0,li.d)({refCount:!0,bufferSize:1})),s=t.pipe((0,U.b)((e=>Mt(this,void 0,void 0,(function*(){let i;return i=e.canEditAnyCollection?yield this.cipherService.getAllFromApiForOrganization(e.id):(yield this.cipherService.getAllDecrypted()).filter((i=>i.organizationId===e.id)),yield this.searchService.indexCiphers(i,e.id),i}))))),c=(0,v.a)([s,e,this.currentSearchText$]).pipe((0,oi.h)((([e,i])=>null!=e&&null!=i)),(0,U.b)((([e,i,t])=>Mt(this,void 0,void 0,(function*(){if(void 0===i.collectionId&&void 0===i.type)return[];const n=(0,Ui.E)(i);return this.searchService.isSearchable(t)?yield this.searchService.searchCiphers(t,[n],e):e.filter(n)})))),(0,li.d)({refCount:!0,bufferSize:1})),a=r.pipe((0,Z.U)((e=>(0,_i.o)(e))),(0,li.d)({refCount:!0,bufferSize:1})),u=(0,v.a)([a,e,this.currentSearchText$]).pipe((0,oi.h)((([e,i])=>null!=e&&null!=i)),(0,Z.U)((([e,i,t])=>{var n;if(i.collectionId===Zi.JK||void 0===i.collectionId&&void 0!==i.type)return[];let o=[];if(void 0===i.collectionId||i.collectionId===Zi.oT)o=e.map((e=>e.node));else{const t=ai.L.getTreeNodeObjectFromList(e,i.collectionId);o=null!==(n=null==t?void 0:t.children.map((e=>e.node)))&&void 0!==n?n:[]}return this.searchService.isSearchable(t)&&(o=this.searchPipe.transform(o,t,(e=>e.name),(e=>e.id))),o})),(0,_.R)(this.destroy$),(0,li.d)({refCount:!0,bufferSize:1})),d=(0,v.a)([a,e]).pipe((0,oi.h)((([e,i])=>null!=e&&null!=i)),(0,Z.U)((([e,i])=>{if(void 0!==i.collectionId&&i.collectionId!==Zi.oT&&i.collectionId!==Zi.JK)return ai.L.getTreeNodeObjectFromList(e,i.collectionId)})),(0,li.d)({refCount:!0,bufferSize:1})),h=(0,v.a)([e,d,t]).pipe((0,Z.U)((([e,i,t])=>e.collectionId===Zi.JK&&!t.canUseAdminCollections||null!=i&&!i.node.assigned&&!t.canUseAdminCollections)),(0,li.d)({refCount:!0,bufferSize:1}));n.pipe((0,m.w)((()=>(0,v.a)([this.route.queryParams,t]))),(0,m.w)((([e,i])=>Mt(this,void 0,void 0,(function*(){const t=Ht(e);t&&(i.canUseAdminCollections||null!=(yield this.cipherService.get(t))?this.editCipherId(t):(this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),this.i18nService.t("unknownCipher")),this.router.navigate([],{queryParams:{cipherId:null,itemId:null},queryParamsHandling:"merge"})))})))),(0,_.R)(this.destroy$)).subscribe(),n.pipe((0,m.w)((()=>(0,v.a)([this.route.queryParams,t,s]))),(0,m.w)((([e,i,t])=>Mt(this,void 0,void 0,(function*(){const n=e.viewEvents;if(!n)return;const o=t.find((e=>e.id===n));i.useEvents&&null!=o?this.viewEvents(o):(this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),this.i18nService.t("unknownCipher")),this.router.navigate([],{queryParams:{viewEvents:null},queryParamsHandling:"merge"}))})))),(0,_.R)(this.destroy$)).subscribe(),n.pipe((0,m.w)((()=>this.refresh$)),(0,f.b)((()=>this.refreshing=!0)),(0,m.w)((()=>(0,v.a)([t,e,r,l,c,u,d,h]))),(0,_.R)(this.destroy$)).subscribe((([e,i,t,n,o,r,l,s])=>{this.organization=e,this.filter=i,this.allCollections=t,this.allGroups=n,this.ciphers=o,this.collections=r,this.selectedCollection=l,this.showMissingCollectionPermissionMessage=s,this.isEmpty=0===(null==r?void 0:r.length)&&0===(null==o?void 0:o.length),this.vaultFilterService.reloadCollections(t),this.refreshing=!1,this.performingInitialLoad=!1}))}))}get loading(){return this.refreshing||this.processingEvent}ngOnDestroy(){this.broadcasterService.unsubscribe(Bt),this.destroy$.next(),this.destroy$.complete()}onVaultItemsEvent(e){return Mt(this,void 0,void 0,(function*(){this.processingEvent=!0;try{if("viewAttachments"===e.type)yield this.editCipherAttachments(e.item);else if("viewCollections"===e.type)yield this.editCipherCollections(e.item);else if("clone"===e.type)yield this.cloneCipher(e.item);else if("restore"===e.type)1===e.items.length?yield this.restore(e.items[0]):yield this.bulkRestore(e.items);else if("delete"===e.type){const i=e.items.filter((e=>void 0===e.collection)).map((e=>e.cipher)),t=e.items.filter((e=>void 0===e.cipher)).map((e=>e.collection));1===i.length&&0===t.length?yield this.deleteCipher(i[0]):0===i.length&&1===t.length?yield this.deleteCollection(t[0]):yield this.bulkDelete(i,t,this.organization)}else"copyField"===e.type?yield this.copy(e.item,e.field):"edit"===e.type?yield this.editCollection(e.item,De.sn.Info):"viewAccess"===e.type?yield this.editCollection(e.item,De.sn.Access):"viewEvents"===e.type&&(yield this.viewEvents(e.item))}finally{this.processingEvent=!1}}))}filterSearchText(e){this.searchText$.next(e)}editCipherAttachments(e){return Mt(this,void 0,void 0,(function*(){if(null==this.organization.maxStorageGb||0===this.organization.maxStorageGb)return void this.messagingService.send("upgradeOrganization",{organizationId:e.organizationId});let i=!1;const[t]=yield this.modalService.openViewRef(Di,this.attachmentsModalRef,(t=>{t.organization=this.organization,t.cipherId=e.id,t.onUploadedAttachment.pipe((0,_.R)(this.destroy$)).subscribe((()=>i=!0)),t.onDeletedAttachment.pipe((0,_.R)(this.destroy$)).subscribe((()=>i=!0))}));t.onClosed.pipe((0,_.R)(this.destroy$)).subscribe((()=>{i&&this.refresh(),i=!1}))}))}editCipherCollections(e){return Mt(this,void 0,void 0,(function*(){const i=yield(0,ni.z)(this.vaultFilterService.filteredCollections$),[t]=yield this.modalService.openViewRef(Wi,this.collectionsModalRef,(n=>{n.collectionIds=e.collectionIds,n.collections=i.filter((e=>!e.readOnly&&e.id!=Zi.JK)),n.organization=this.organization,n.cipherId=e.id,n.onSavedCollections.pipe((0,_.R)(this.destroy$)).subscribe((()=>{t.close(),this.refresh()}))}))}))}addCipher(){return Mt(this,void 0,void 0,(function*(){const e=(yield(0,ni.z)(this.vaultFilterService.filteredCollections$)).filter((e=>!e.readOnly&&e.id!=Zi.JK));yield this.editCipher(null,(i=>{i.type=this.activeFilter.cipherType,i.collections=e,this.activeFilter.collectionId&&(i.collectionIds=[this.activeFilter.collectionId])}))}))}navigateToCipher(e){return Mt(this,void 0,void 0,(function*(){this.go({itemId:null==e?void 0:e.id})}))}editCipher(e,i){return Mt(this,void 0,void 0,(function*(){return this.editCipherId(null==e?void 0:e.id,i)}))}editCipherId(e,i){return Mt(this,void 0,void 0,(function*(){const t=yield this.cipherService.get(e);if(null!=t&&0!=t.reprompt&&!(yield this.passwordRepromptService.showPasswordPrompt()))return void this.go({cipherId:null,itemId:null});const n=i=>{i.organization=this.organization,i.organizationId=this.organization.id,i.cipherId=e,i.onSavedCipher.pipe((0,_.R)(this.destroy$)).subscribe((()=>{o.close(),this.refresh()})),i.onDeletedCipher.pipe((0,_.R)(this.destroy$)).subscribe((()=>{o.close(),this.refresh()})),i.onRestoredCipher.pipe((0,_.R)(this.destroy$)).subscribe((()=>{o.close(),this.refresh()}))},[o,r]=yield this.modalService.openViewRef(wi.Z,this.cipherAddEditModalRef,null==i?n:e=>{n(e),i(e)});return o.onClosedPromise().then((()=>{this.go({cipherId:null,itemId:null})})),r}))}cloneCipher(e){return Mt(this,void 0,void 0,(function*(){const i=(yield(0,ni.z)(this.vaultFilterService.filteredCollections$)).filter((e=>!e.readOnly&&e.id!=Zi.JK));yield this.editCipher(e,(t=>{t.cloneMode=!0,t.collections=i,t.collectionIds=e.collectionIds}))}))}restore(e){var i;return Mt(this,void 0,void 0,(function*(){if(!(yield this.repromptCipher([e])))return;if(!e.isDeleted)return;if(!(yield this.dialogService.openSimpleDialog({title:{key:"restoreItem"},content:{key:"restoreItemConfirmation"},type:x.rC.WARNING})))return!1;try{const t=null===(i=this.organization)||void 0===i?void 0:i.canEditAnyCollection;yield this.cipherService.restoreWithServer(e.id,t),this.platformUtilsService.showToast("success",null,this.i18nService.t("restoredItem")),this.refresh()}catch(t){this.logService.error(t)}}))}bulkRestore(e){return Mt(this,void 0,void 0,(function*(){if(!(yield this.repromptCipher(e)))return;const i=e.map((e=>e.id));if(0===i.length)return void this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),this.i18nService.t("nothingSelected"));const t=(0,mi.OP)(this.dialogService,{data:{cipherIds:i}});(yield(0,w.n)(t.closed))===mi.Hn.Restored&&this.refresh()}))}deleteCipher(e){return Mt(this,void 0,void 0,(function*(){if(!(yield this.repromptCipher([e])))return;const i=e.isDeleted;if(!(yield this.dialogService.openSimpleDialog({title:{key:i?"permanentlyDeleteItem":"deleteItem"},content:{key:i?"permanentlyDeleteItemConfirmation":"deleteItemConfirmation"},type:x.rC.WARNING})))return!1;try{yield this.deleteCipherWithServer(e.id,i),this.platformUtilsService.showToast("success",null,this.i18nService.t(i?"permanentlyDeletedItem":"deletedItem")),this.refresh()}catch(t){this.logService.error(t)}}))}deleteCollection(e){var i,t,n,o;return Mt(this,void 0,void 0,(function*(){if(!this.organization.canDeleteAssignedCollections&&!this.organization.canDeleteAnyCollection)return void this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),this.i18nService.t("missingPermissions"));if(yield this.dialogService.openSimpleDialog({title:e.name,content:{key:"deleteCollectionConfirmation"},type:x.rC.WARNING}))try{yield this.apiService.deleteCollection(null===(i=this.organization)||void 0===i?void 0:i.id,e.id),this.platformUtilsService.showToast("success",null,this.i18nService.t("deletedCollectionId",e.name)),(null===(t=this.selectedCollection)||void 0===t?void 0:t.node.id)===e.id&&this.router.navigate([],{queryParams:{collectionId:null!==(o=null===(n=this.selectedCollection.parent)||void 0===n?void 0:n.node.id)&&void 0!==o?o:null},queryParamsHandling:"merge",replaceUrl:!0}),this.refresh()}catch(r){this.logService.error(r)}}))}bulkDelete(e,i,t){return Mt(this,void 0,void 0,(function*(){if(!(yield this.repromptCipher(e)))return;if(0===e.length&&0===i.length)return void this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),this.i18nService.t("nothingSelected"));const n=(0,fi.E)(this.dialogService,{data:{permanent:"trash"===this.filter.type,cipherIds:e.map((e=>e.id)),collectionIds:i.map((e=>e.id)),organization:t}});(yield(0,w.n)(n.closed))===fi.Jg.Deleted&&this.refresh()}))}copy(e,i){return Mt(this,void 0,void 0,(function*(){let t,n,o;if("username"===i)t="Username",n=e.login.username,o="username";else if("password"===i)t="Password",n=e.login.password,o="password";else{if("totp"!==i)return void this.platformUtilsService.showToast("info",null,this.i18nService.t("unexpectedError"));t="TOTP",n=yield this.totpService.getCode(e.login.totp),o="verificationCodeTotp"}this.passwordRepromptService.protectedFields().includes(t)&&!(yield this.repromptCipher([e]))||e.viewPassword&&(this.platformUtilsService.copyToClipboard(n,{window}),this.platformUtilsService.showToast("info",null,this.i18nService.t("valueCopied",this.i18nService.t(o))),"password"===i?this.eventCollectionService.collect(ci.tw.Cipher_ClientCopiedPassword,e.id):"totp"===i&&this.eventCollectionService.collect(ci.tw.Cipher_ClientCopiedHiddenField,e.id))}))}addCollection(){var e,i;return Mt(this,void 0,void 0,(function*(){const t=(0,De.ku)(this.dialogService,{data:{organizationId:null===(e=this.organization)||void 0===e?void 0:e.id,parentCollectionId:null===(i=this.selectedCollection)||void 0===i?void 0:i.node.id}}),n=yield(0,w.n)(t.closed);n.action!==De.a8.Saved&&n.action!==De.a8.Deleted||this.refresh()}))}editCollection(e,i){var t;return Mt(this,void 0,void 0,(function*(){const n=(0,De.ku)(this.dialogService,{data:{collectionId:null==e?void 0:e.id,organizationId:null===(t=this.organization)||void 0===t?void 0:t.id,initialTab:i}}),o=yield(0,w.n)(n.closed);o.action!==De.a8.Saved&&o.action!==De.a8.Deleted||this.refresh()}))}viewEvents(e){return Mt(this,void 0,void 0,(function*(){yield(0,hi.Z)(this.dialogService,{data:{name:e.name,organizationId:this.organization.id,entityId:e.id,showUser:!0,entity:"cipher"}})}))}deleteCipherWithServer(e,i){var t;const n=null===(t=this.organization)||void 0===t?void 0:t.canEditAnyCollection;return i?this.cipherService.deleteWithServer(e,n):this.cipherService.softDeleteWithServer(e,n)}repromptCipher(e){return Mt(this,void 0,void 0,(function*(){const i=!e.find((e=>e.reprompt!==ui.N.None));return i||(yield this.passwordRepromptService.showPasswordPrompt())}))}refresh(){this.refresh$.next()}go(e=null){null==e&&(e={type:this.activeFilter.cipherType,collectionId:this.activeFilter.collectionId,deleted:this.activeFilter.isDeleted||null}),this.router.navigate([],{relativeTo:this.route,queryParams:e,queryParamsHandling:"merge",replaceUrl:!0})}}jt.ɵfac=function(e){return new(e||jt)(h.Y36(l.gz),h.Y36(c.Mn),h.Y36(Ee.n),h.Y36(vi.b),h.Y36(bi.q),h.Y36(l.F0),h.Y36(h.sBO),h.Y36(rt._),h.Y36(N.D),h.Y36(C.Z),h.Y36(x.eo),h.Y36(lt.o),h.Y36(st.A),h.Y36(h.R0b),h.Y36(k.P),h.Y36(Ve.u),h.Y36(ct.C),h.Y36(He.m),h.Y36(he.o),h.Y36(y.C),h.Y36(r.lT),h.Y36(D.$),h.Y36(at.j),h.Y36(ut.w),h.Y36(L.s))},jt.ɵcmp=h.Xpm({type:jt,selectors:[["app-org-vault"]],viewQuery:function(e,i){if(1&e&&(h.Gf(Jt,7),h.Gf(Ft,7,h.s_b),h.Gf(Ot,7,h.s_b),h.Gf(Lt,7,h.s_b)),2&e){let e;h.iGM(e=h.CRH())&&(i.vaultFilterComponent=e.first),h.iGM(e=h.CRH())&&(i.attachmentsModalRef=e.first),h.iGM(e=h.CRH())&&(i.cipherAddEditModalRef=e.first),h.iGM(e=h.CRH())&&(i.collectionsModalRef=e.first)}},features:[h._Bn([bi.q,vi.b])],decls:47,vars:31,consts:[[1,"container","page-content"],[1,"row"],[1,"col-3"],[1,"groupings"],[1,"content"],[1,"inner-content"],[3,"organization","activeFilter","searchText","searchTextChanged"],["vaultFilter",""],[1,"col-9"],[3,"filter","loading","organization","collection","onAddCipher","onAddCollection","onEditCollection","onDeleteCollection"],["type","warning","icon","bwi bwi-exclamation-triangle",4,"ngIf"],[3,"ciphers","collections","allCollections","allOrganizations","allGroups","disabled","showOwner","showCollections","showGroups","showPremiumFeatures","showBulkMove","showBulkTrashOptions","useEvents","editableCollections","cloneableOrganizationCiphers","onEvent"],["class","tw-mt-6 tw-flex tw-h-full tw-flex-col tw-items-center tw-justify-start",4,"ngIf"],["attachments",""],["cipherAddEdit",""],["collectionsModal",""],["type","warning","icon","bwi bwi-exclamation-triangle"],[1,"tw-mt-6","tw-flex","tw-h-full","tw-flex-col","tw-items-center","tw-justify-start"],["aria-hidden","true",3,"icon"],["type","button","buttonType","primary","bitButton","",3,"click",4,"ngIf"],["type","button","buttonType","primary","bitButton","",3,"click"],["aria-hidden","true",1,"bwi","bwi-plus","bwi-fw"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin","text-muted",3,"title"],[1,"sr-only"]],template:function(e,i){1&e&&(h.TgZ(0,"div",0),h._uU(1,"\n  "),h.TgZ(2,"div",1),h._uU(3,"\n    "),h.TgZ(4,"div",2),h._uU(5,"\n      "),h.TgZ(6,"div",3),h._uU(7,"\n        "),h.TgZ(8,"div",4),h._uU(9,"\n          "),h.TgZ(10,"div",5),h._uU(11,"\n            "),h.TgZ(12,"app-organization-vault-filter",6,7),h.NdJ("searchTextChanged",(function(e){return i.filterSearchText(e)})),h.ALo(14,"async"),h.qZA(),h._uU(15,"\n          "),h.qZA(),h._uU(16,"\n        "),h.qZA(),h._uU(17,"\n      "),h.qZA(),h._uU(18,"\n    "),h.qZA(),h._uU(19,"\n    "),h.TgZ(20,"div",8),h._uU(21,"\n      "),h.TgZ(22,"app-org-vault-header",9),h.NdJ("onAddCipher",(function(){return i.addCipher()}))("onAddCollection",(function(){return i.addCollection()}))("onEditCollection",(function(e){return i.editCollection(i.selectedCollection.node,e.tab)}))("onDeleteCollection",(function(){return i.deleteCollection(i.selectedCollection.node)})),h.qZA(),h._uU(23,"\n      "),h.YNc(24,Yt,2,1,"app-callout",10),h._uU(25,"\n      "),h.TgZ(26,"app-vault-items",11),h.NdJ("onEvent",(function(e){return i.onVaultItemsEvent(e)})),h._uU(27,"\n      "),h.qZA(),h._uU(28,"\n      "),h.YNc(29,Nt,8,4,"div",12),h._uU(30,"\n      "),h.YNc(31,kt,10,5,"div",12),h._uU(32,"\n      "),h.YNc(33,Dt,9,6,"div",12),h._uU(34,"\n    "),h.qZA(),h._uU(35,"\n  "),h.qZA(),h._uU(36,"\n  "),h.YNc(37,$t,0,0,"ng-template",null,13,h.W1O),h._uU(39,"\n  "),h.YNc(40,Qt,0,0,"ng-template",null,14,h.W1O),h._uU(42,"\n  "),h.YNc(43,Pt,0,0,"ng-template",null,15,h.W1O),h._uU(45,"\n"),h.qZA(),h._uU(46,"\n")),2&e&&(h.xp6(12),h.Q6J("organization",i.organization)("activeFilter",i.activeFilter)("searchText",h.lcZ(14,26,i.currentSearchText$)),h.xp6(10),h.Q6J("filter",i.filter)("loading",i.refreshing)("organization",i.organization)("collection",i.selectedCollection),h.xp6(2),h.Q6J("ngIf",i.activeFilter.isDeleted),h.xp6(2),h.Q6J("ciphers",i.ciphers)("collections",i.collections)("allCollections",i.allCollections)("allOrganizations",i.organization?h.VKq(28,Et,i.organization):h.DdM(30,Rt))("allGroups",i.allGroups)("disabled",i.loading)("showOwner",!1)("showCollections",void 0!==i.filter.type)("showGroups",(null==i.organization?null:i.organization.useGroups)&&(void 0===i.filter.type&&void 0===i.filter.collectionId||void 0!==i.filter.collectionId))("showPremiumFeatures",null==i.organization?null:i.organization.useTotp)("showBulkMove",!1)("showBulkTrashOptions","trash"===i.filter.type)("useEvents",null==i.organization?null:i.organization.useEvents)("editableCollections",!0)("cloneableOrganizationCiphers",!0),h.xp6(3),h.Q6J("ngIf",i.showMissingCollectionPermissionMessage),h.xp6(2),h.Q6J("ngIf",i.isEmpty&&!i.showMissingCollectionPermissionMessage&&!i.performingInitialLoad),h.xp6(2),h.Q6J("ngIf",i.performingInitialLoad))},dependencies:[ot,$.O5,dt.O,j.r,ht.G,pt.JS,zt,$.Ov,re.C],encapsulation:2});const Ht=e=>e.itemId||e.cipherId,Kt=[{path:"",component:jt,canActivate:[a.G],data:{titleId:"vaults",organizationPermissions:c.Po}}];class Wt{}Wt.ɵfac=function(e){return new(e||Wt)},Wt.ɵmod=h.oAB({type:Wt}),Wt.ɵinj=h.cJS({imports:[l.Bz.forChild(Kt),l.Bz]});class Vt{}Vt.ɵfac=function(e){return new(e||Vt)},Vt.ɵmod=h.oAB({type:Vt}),Vt.ɵinj=h.cJS({imports:[Wt,ti,Ne.m,Ye.f,Pe.x,Qe.e,Ge.D,ke.D,Le.J,$e.z,De.WK]});const Xt=[{path:":organizationId",component:d.f,canActivate:[s.a,a.G],data:{organizationPermissions:c.gW},children:[{path:"",pathMatch:"full",canActivate:[u.S],data:{autoRedirectCallback:function(e){if((0,c.Po)(e))return"vault";if((0,c.tt)(e))return"members";if((0,c.WW)(e))return"groups";if((0,c.$G)(e))return"reporting";if((0,c.DL)(e))return"settings";return}},children:[]},{path:"vault",loadChildren:()=>Vt},{path:"settings",loadChildren:()=>t.e(950).then(t.bind(t,81950)).then((e=>e.OrganizationSettingsModule))},{path:"members",loadChildren:()=>t.e(651).then(t.bind(t,7651)).then((e=>e.MembersModule))},{path:"groups",component:Oe,canActivate:[a.G],data:{titleId:"groups",organizationPermissions:c.WW}},{path:"reporting",loadChildren:()=>t.e(466).then(t.bind(t,41466)).then((e=>e.OrganizationReportingModule))},{path:"billing",loadChildren:()=>t.e(555).then(t.bind(t,37555)).then((e=>e.OrganizationBillingModule))}]}];class en{}en.ɵfac=function(e){return new(e||en)},en.ɵmod=h.oAB({type:en}),en.ɵinj=h.cJS({imports:[l.Bz.forChild(Xt),l.Bz]});var tn=t(64984);class nn{}nn.ɵfac=function(e){return new(e||nn)},nn.ɵmod=h.oAB({type:nn}),nn.ɵinj=h.cJS({imports:[tn.P,O.k4,r.WO,en]})},14309:(e,i,t)=>{t.d(i,{E2:()=>r.E2,R9:()=>n.R,d4:()=>r.d4,k4:()=>o.k,zD:()=>r.zD});var n=t(36689),o=t(1176),r=t(34632)},64984:(e,i,t)=>{t.d(i,{P:()=>s});var n=t(27420),o=t(27406),r=t(1176),l=t(24852);class s{}s.ɵfac=function(e){return new(e||s)},s.ɵmod=l.oAB({type:s}),s.ɵinj=l.cJS({imports:[o.m,r.k,n.t,o.m,r.k,n.t]})}}]);
//# sourceMappingURL=126.8f3727cecfee6f87773c.js.map